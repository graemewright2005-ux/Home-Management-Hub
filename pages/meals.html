<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Manage your meal recipes and plan your weekly menu">
    <title>Meal Recipes - Home Management Hub</title>
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/components.css">
    <link rel="stylesheet" href="../css/responsive.css">
    <style>
        /* Page-specific styles */
        .meals-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .meals-header h1 {
            margin: 0;
            color: var(--text-dark, #2d3748);
        }

        .filters-section {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .filter-group {
            margin-bottom: 1.5rem;
        }

        .filter-group:last-child {
            margin-bottom: 0;
        }

        .filter-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-dark, #2d3748);
            font-size: 0.9rem;
        }

        .filter-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            border: 2px solid #e2e8f0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .filter-btn:hover {
            border-color: #805ad5;
            background: #f7fafc;
        }

        .filter-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .search-box {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        .search-box:focus {
            outline: none;
            border-color: #667eea;
        }

        .ingredient-select {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
        }

        .meals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .meal-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            position: relative;
        }

        .meal-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
        }

        .meal-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
        }

        .meal-content {
            padding: 1rem;
        }

        .meal-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-dark, #2d3748);
        }

        .meal-type {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: #e2e8f0;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            text-transform: capitalize;
        }

        .meal-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
            margin-bottom: 0.5rem;
        }

        .dietary-tag {
            padding: 0.2rem 0.5rem;
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .dietary-tag.meat { border-color: #fc8181; color: #c53030; }
        .dietary-tag.fish { border-color: #63b3ed; color: #2c5282; }
        .dietary-tag.vegetarian { border-color: #68d391; color: #22543d; }
        .dietary-tag.vegan { border-color: #48bb78; color: #22543d; }
        .dietary-tag.dairy-free { border-color: #fbd38d; color: #744210; }
        .dietary-tag.gluten-free { border-color: #f6ad55; color: #7c2d12; }

        .meal-calories {
            color: #718096;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .favourite-icon {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            font-size: 1.5rem;
            z-index: 10;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow-y: auto;
            padding: 1rem;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            color: var(--text-dark, #2d3748);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #718096;
            padding: 0;
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .modal-close:hover {
            background: #f7fafc;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid #e2e8f0;
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-dark, #2d3748);
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        .checkbox-label input[type="checkbox"] {
            width: 1.25rem;
            height: 1.25rem;
            cursor: pointer;
        }

        .image-preview {
            margin-top: 1rem;
            max-width: 100%;
            border-radius: 8px;
            display: none;
        }

        .image-preview.active {
            display: block;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: var(--text-dark, #2d3748);
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }

        .btn-danger {
            background: #fc8181;
            color: white;
        }

        .btn-danger:hover {
            background: #f56565;
        }

        .view-meal-image {
            width: 100%;
            height: 250px;
            object-fit: cover;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 6rem;
            margin-bottom: 1rem;
            border-radius: 8px;
        }

        .meal-detail-section {
            margin-bottom: 1.5rem;
        }

        .meal-detail-section h3 {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: var(--text-dark, #2d3748);
        }

        .meal-detail-section ul {
            margin: 0;
            padding-left: 1.5rem;
        }

        .meal-detail-section li {
            margin-bottom: 0.25rem;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: #718096;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .empty-state h3 {
            margin-bottom: 0.5rem;
            color: var(--text-dark, #2d3748);
        }

        .results-count {
            color: #718096;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        @media (max-width: 768px) {
            .meals-grid {
                grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
                gap: 1rem;
            }

            .filter-buttons {
                gap: 0.25rem;
            }

            .filter-btn {
                padding: 0.4rem 0.8rem;
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <nav class="main-nav" role="navigation" aria-label="Main navigation">
        <div class="nav-container">
            <h1 class="nav-brand">üè† Home Hub</h1>
            <button class="nav-toggle" aria-label="Toggle navigation" aria-expanded="false">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <ul class="nav-menu">
                <li><a href="../index.html">üìä Dashboard</a></li>
                <li><a href="meals.html" class="active" aria-current="page">üçΩÔ∏è Meals</a></li>
                <li><a href="planner.html">üìÖ Planner</a></li>
                <li><a href="shopping.html">üõí Shopping</a></li>
                <li><a href="cleaning.html">üßπ Cleaning</a></li>
                <li><a href="maintenance.html">üîß Maintenance</a></li>
                <li><a href="settings.html">‚öôÔ∏è Settings</a></li>
            </ul>
        </div>
    </nav>

    <main class="main-content">
        <div class="meals-header">
            <h1>Meal Recipes</h1>
            <button class="btn btn-primary" id="addMealBtn" aria-label="Add new recipe">
                ‚ûï Add Recipe
            </button>
        </div>

        <section class="filters-section" aria-label="Filter recipes">
            <div class="filter-group">
                <label class="filter-label">Meal Type</label>
                <div class="filter-buttons" role="group" aria-label="Filter by meal type">
                    <button class="filter-btn active" data-filter="type" data-value="all">All</button>
                    <button class="filter-btn" data-filter="type" data-value="breakfast">Breakfast</button>
                    <button class="filter-btn" data-filter="type" data-value="lunch">Lunch</button>
                    <button class="filter-btn" data-filter="type" data-value="dinner">Dinner</button>
                    <button class="filter-btn" data-filter="type" data-value="snack">Snacks</button>
                </div>
            </div>

            <div class="filter-group">
                <label class="filter-label">Dietary</label>
                <div class="filter-buttons" role="group" aria-label="Filter by dietary type">
                    <button class="filter-btn active" data-filter="dietary" data-value="all">All</button>
                    <button class="filter-btn" data-filter="dietary" data-value="meat">Meat</button>
                    <button class="filter-btn" data-filter="dietary" data-value="fish">Fish</button>
                    <button class="filter-btn" data-filter="dietary" data-value="vegetarian">Vegetarian</button>
                    <button class="filter-btn" data-filter="dietary" data-value="vegan">Vegan</button>
                    <button class="filter-btn" data-filter="dietary" data-value="dairy-free">Dairy-Free</button>
                    <button class="filter-btn" data-filter="dietary" data-value="gluten-free">Gluten-Free</button>
                </div>
            </div>

            <div class="filter-group">
                <label class="filter-label" for="ingredientFilter">Main Ingredient</label>
                <select class="ingredient-select" id="ingredientFilter" aria-label="Filter by main ingredient">
                    <option value="all">All Ingredients</option>
                </select>
            </div>

            <div class="filter-group">
                <label class="filter-label" for="searchBox">Search Recipes</label>
                <input 
                    type="search" 
                    class="search-box" 
                    id="searchBox" 
                    placeholder="Search by title or ingredients..."
                    aria-label="Search recipes by title or ingredients"
                >
            </div>

            <div class="filter-group">
                <div class="filter-buttons">
                    <button class="filter-btn" id="favouritesBtn" data-filter="favourites">
                        ‚≠ê Favourites Only
                    </button>
                </div>
            </div>
        </section>

        <div class="results-count" id="resultsCount" role="status" aria-live="polite"></div>

        <div class="meals-grid" id="mealsGrid" role="list"></div>

        <div class="empty-state" id="emptyState" style="display: none;">
            <div class="empty-state-icon">üçΩÔ∏è</div>
            <h3>No meals found</h3>
            <p>Try adjusting your filters or add a new recipe</p>
        </div>
    </main>

    <!-- Add Meal Modal -->
    <div class="modal" id="addMealModal" role="dialog" aria-labelledby="addMealTitle" aria-modal="true">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="addMealTitle">Add New Recipe</h2>
                <button class="modal-close" aria-label="Close modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addMealForm">
                    <div class="form-group">
                        <label class="form-label" for="mealImage">Recipe Image</label>
                        <input type="file" class="form-input" id="mealImage" accept="image/*" aria-describedby="imageHelp">
                        <small id="imageHelp" style="color: #718096; font-size: 0.85rem;">Optional: Add a photo of your dish</small>
                        <img id="imagePreview" class="image-preview" alt="Recipe preview">
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="mealTitle">Recipe Title *</label>
                        <input type="text" class="form-input" id="mealTitle" required aria-required="true">
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="mealType">Meal Type *</label>
                        <select class="form-select" id="mealType" required aria-required="true">
                            <option value="">Select meal type</option>
                            <option value="breakfast">Breakfast</option>
                            <option value="lunch">Lunch</option>
                            <option value="dinner">Dinner</option>
                            <option value="snack">Snack</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="mealIngredients">Ingredients (one per line) *</label>
                        <textarea class="form-textarea" id="mealIngredients" required aria-required="true" aria-describedby="ingredientsHelp"></textarea>
                        <small id="ingredientsHelp" style="color: #718096; font-size: 0.85rem;">Enter each ingredient on a new line</small>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="mealMainIngredients">Main Ingredients (comma-separated)</label>
                        <input type="text" class="form-input" id="mealMainIngredients" placeholder="e.g., chicken, rice, broccoli" aria-describedby="mainIngredientsHelp">
                        <small id="mainIngredientsHelp" style="color: #718096; font-size: 0.85rem;">Used for filtering</small>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="mealInstructions">Cooking Instructions *</label>
                        <textarea class="form-textarea" id="mealInstructions" required aria-required="true"></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="mealEquipment">Equipment Needed</label>
                        <input type="text" class="form-input" id="mealEquipment" placeholder="e.g., Large pan, oven, mixing bowl">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Dietary Tags</label>
                        <div class="checkbox-group" role="group" aria-label="Select dietary tags">
                            <label class="checkbox-label">
                                <input type="checkbox" name="dietary" value="meat">
                                <span>Meat</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="dietary" value="fish">
                                <span>Fish</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="dietary" value="vegetarian">
                                <span>Vegetarian</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="dietary" value="vegan">
                                <span>Vegan</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="dietary" value="dairy-free">
                                <span>Dairy-Free</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="dietary" value="gluten-free">
                                <span>Gluten-Free</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="mealServings">Servings</label>
                        <input type="number" class="form-input" id="mealServings" value="2" min="1" max="12">
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="mealCalories">Calories per Serving</label>
                        <input type="number" class="form-input" id="mealCalories" min="0" step="10">
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="mealFavourite">
                            <span>‚≠ê Add to Favourites</span>
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelAddBtn">Cancel</button>
                <button type="submit" form="addMealForm" class="btn btn-primary">Save Recipe</button>
            </div>
        </div>
    </div>

    <!-- View Meal Modal -->
    <div class="modal" id="viewMealModal" role="dialog" aria-labelledby="viewMealTitle" aria-modal="true">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="viewMealTitle"></h2>
                <button class="modal-close" aria-label="Close modal">&times;</button>
            </div>
            <div class="modal-body" id="viewMealBody">
                <!-- Content populated dynamically -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" id="deleteMealBtn">Delete</button>
                <button type="button" class="btn btn-secondary" id="toggleFavBtn">‚≠ê Favourite</button>
                <button type="button" class="btn btn-primary" id="closeMealBtn">Close</button>
            </div>
        </div>
    </div>

    <script type="module">
        // Sample meal data - Note: This is a condensed version. In production, you'd have all 300 meals.
        // Due to size constraints, I'm including a representative sample that demonstrates all meal types and dietary options.
        const sampleMeals = [
            // BREAKFAST SAMPLES
            {title:"Full English Breakfast",type:"breakfast",ingredients:["2 eggs","2 bacon rashers","1 sausage","Baked beans","Mushrooms","Tomato","Toast"],mainIngredients:["eggs","bacon","sausage"],instructions:"1. Grill bacon and sausages\n2. Fry eggs to preference\n3. Warm beans and saut√© mushrooms\n4. Grill tomatoes\n5. Toast bread\n6. Arrange on plate",equipment:"Grill, frying pan, saucepan",dietary:["meat"],servings:1,calories:850,emoji:"üç≥"},
            {title:"Porridge with Berries",type:"breakfast",ingredients:["50g oats","250ml milk or water","Handful of mixed berries","1 tbsp honey","Pinch of salt"],mainIngredients:["oats","berries"],instructions:"1. Add oats and liquid to pan\n2. Cook on medium heat, stirring\n3. Add pinch of salt\n4. Cook until creamy (5 mins)\n5. Top with berries and honey",equipment:"Saucepan, wooden spoon",dietary:["vegetarian"],servings:1,calories:320,emoji:"ü•£"},
            {title:"Avocado Toast with Poached Egg",type:"breakfast",ingredients:["2 slices sourdough","1 ripe avocado","2 eggs","Cherry tomatoes","Salt","Pepper","Chilli flakes"],mainIngredients:["avocado","eggs","bread"],instructions:"1. Toast bread\n2. Poach eggs in simmering water\n3. Mash avocado with salt and pepper\n4. Spread on toast\n5. Top with poached eggs\n6. Garnish with tomatoes and chilli",equipment:"Toaster, saucepan",dietary:["vegetarian"],servings:1,calories:420,emoji:"ü•ë"},
            {title:"Smoked Salmon Bagel",type:"breakfast",ingredients:["1 bagel","100g smoked salmon","2 tbsp cream cheese","Red onion slices","Capers","Dill","Lemon"],mainIngredients:["salmon","bagel","cream cheese"],instructions:"1. Toast bagel halves\n2. Spread cream cheese on both sides\n3. Layer smoked salmon\n4. Add onion slices and capers\n5. Garnish with dill\n6. Squeeze lemon over",equipment:"Toaster",dietary:["fish"],servings:1,calories:450,emoji:"ü•Ø"},
            {title:"Smoothie Bowl",type:"breakfast",ingredients:["2 frozen bananas","Handful spinach","1 cup berries","Almond milk","Toppings: granola, coconut, chia"],mainIngredients:["banana","berries","spinach"],instructions:"1. Blend frozen bananas until smooth\n2. Add spinach and berries\n3. Add milk to reach thick consistency\n4. Pour into bowl\n5. Arrange toppings artistically\n6. Serve immediately",equipment:"Blender",dietary:["vegan","dairy-free"],servings:1,calories:320,emoji:"ü•§"},
            
            // LUNCH SAMPLES  
            {title:"Chicken Caesar Salad",type:"lunch",ingredients:["Chicken breast","Romaine lettuce","Parmesan","Croutons","Caesar dressing","Lemon"],mainIngredients:["chicken","lettuce"],instructions:"1. Grill or pan-fry chicken\n2. Slice into strips\n3. Tear lettuce into bowl\n4. Add croutons and parmesan\n5. Drizzle with dressing\n6. Top with chicken and serve",equipment:"Grill or frying pan",dietary:["meat"],servings:2,calories:420,emoji:"ü•ó"},
            {title:"BLT Sandwich",type:"lunch",ingredients:["6 bacon rashers","4 slices bread","Lettuce","Tomato slices","Mayonnaise"],mainIngredients:["bacon","lettuce","tomato"],instructions:"1. Grill bacon until crispy\n2. Toast bread\n3. Spread mayo on bread\n4. Layer lettuce, tomato, bacon\n5. Season with pepper\n6. Cut and serve",equipment:"Grill, toaster",dietary:["meat"],servings:2,calories:520,emoji:"ü•™"},
            {title:"Tomato Soup with Crusty Bread",type:"lunch",ingredients:["Tinned tomatoes","Onion","Garlic","Vegetable stock","Cream","Basil","Crusty bread"],mainIngredients:["tomatoes"],instructions:"1. Saut√© onion and garlic\n2. Add tomatoes and stock\n3. Simmer 20 mins\n4. Blend until smooth\n5. Stir in cream\n6. Serve with bread and basil",equipment:"Saucepan, blender",dietary:["vegetarian"],servings:4,calories:280,emoji:"üç≤"},
            {title:"Falafel Wrap",type:"lunch",ingredients:["Falafel","Flatbread","Hummus","Salad leaves","Tomatoes","Cucumber","Tahini sauce"],mainIngredients:["falafel","hummus"],instructions:"1. Heat falafel (oven or air fryer)\n2. Warm flatbread\n3. Spread hummus on bread\n4. Add salad, tomatoes, cucumber\n5. Place falafel on top\n6. Drizzle tahini and wrap",equipment:"Oven or air fryer",dietary:["vegan","dairy-free"],servings:2,calories:420,emoji:"üåØ"},
            {title:"Jacket Potato with Beans",type:"lunch",ingredients:["Large baking potato","Tin of baked beans","Butter","Cheese","Spring onions"],mainIngredients:["potato","beans"],instructions:"1. Bake potato 200¬∞C for 1 hour\n2. Heat beans\n3. Split potato open\n4. Add butter\n5. Pour beans over\n6. Top with cheese and onions",equipment:"Oven, saucepan",dietary:["vegetarian","gluten-free"],servings:1,calories:480,emoji:"ü•î"},

            // DINNER SAMPLES
            {title:"Roast Chicken with Vegetables",type:"dinner",ingredients:["Whole chicken","Potatoes","Carrots","Onions","Garlic","Rosemary","Olive oil"],mainIngredients:["chicken","potatoes"],instructions:"1. Season chicken inside and out\n2. Stuff with lemon and herbs\n3. Arrange vegetables around\n4. Drizzle with oil\n5. Roast 200¬∞C for 1.5 hours\n6. Rest before carving",equipment:"Oven, roasting tin",dietary:["meat","gluten-free"],servings:4,calories:650,emoji:"üçó"},
            {title:"Beef Lasagne",type:"dinner",ingredients:["Lasagne sheets","Minced beef","Tomato sauce","B√©chamel","Mozzarella","Parmesan","Onion","Garlic"],mainIngredients:["beef","pasta"],instructions:"1. Make meat sauce with mince\n2. Make b√©chamel sauce\n3. Layer: sauce, pasta, b√©chamel\n4. Repeat layers\n5. Top with cheese\n6. Bake 180¬∞C for 40 mins",equipment:"Oven, large baking dish",dietary:["meat"],servings:6,calories:580,emoji:"üçù"},
            {title:"Salmon with New Potatoes",type:"dinner",ingredients:["Salmon fillets","New potatoes","Green beans","Dill butter","Lemon","Asparagus"],mainIngredients:["salmon","potatoes"],instructions:"1. Boil new potatoes\n2. Steam green beans\n3. Pan-fry or bake salmon\n4. Make dill butter\n5. Blanch asparagus\n6. Serve with lemon wedges",equipment:"Saucepan, frying pan or oven",dietary:["fish","gluten-free"],servings:2,calories:520,emoji:"üêü"},
            {title:"Vegetable Stir-Fry",type:"dinner",ingredients:["Mixed vegetables","Tofu or chicken","Soy sauce","Ginger","Garlic","Noodles","Sesame oil"],mainIngredients:["vegetables","noodles"],instructions:"1. Cook noodles\n2. Heat wok very hot\n3. Stir-fry protein\n4. Add vegetables\n5. Add sauce and noodles\n6. Toss and serve immediately",equipment:"Wok or large pan",dietary:["vegetarian","dairy-free"],servings:2,calories:420,emoji:"ü•ò"},
            {title:"Fish and Chips",type:"dinner",ingredients:["White fish fillets","Potatoes","Flour","Beer","Mushy peas","Lemon","Tartare sauce"],mainIngredients:["fish","potatoes"],instructions:"1. Cut chips and par-boil\n2. Make batter with flour and beer\n3. Heat oil to 180¬∞C\n4. Coat fish in batter\n5. Fry fish and chips\n6. Serve with peas and lemon",equipment:"Deep fryer or large pan",dietary:["fish"],servings:2,calories:820,emoji:"üêü"},

            // SNACK SAMPLES
            {title:"Hummus with Veggie Sticks",type:"snack",ingredients:["Chickpeas","Tahini","Lemon","Garlic","Carrots","Cucumber","Peppers"],mainIngredients:["chickpeas","vegetables"],instructions:"1. Blend chickpeas with tahini\n2. Add lemon, garlic, oil\n3. Blend until smooth\n4. Cut vegetables into sticks\n5. Arrange on plate\n6. Serve together",equipment:"Blender",dietary:["vegan","dairy-free","gluten-free"],servings:4,calories:180,emoji:"ü•ï"},
            {title:"Greek Yogurt with Honey and Nuts",type:"snack",ingredients:["Greek yogurt","Honey","Mixed nuts","Berries"],mainIngredients:["yogurt","honey","nuts"],instructions:"1. Spoon yogurt into bowl\n2. Drizzle honey\n3. Sprinkle nuts\n4. Add fresh berries\n5. Mix if desired\n6. Enjoy immediately",equipment:"Bowl",dietary:["vegetarian","gluten-free"],servings:1,calories:220,emoji:"ü•Ñ"},
            {title:"Apple Slices with Peanut Butter",type:"snack",ingredients:["Apple","Peanut butter","Optional: raisins"],mainIngredients:["apple","peanut butter"],instructions:"1. Core and slice apple\n2. Spread peanut butter on slices\n3. Top with raisins if using\n4. Arrange on plate\n5. Serve immediately\n6. Enjoy!",equipment:"None",dietary:["vegan","dairy-free","gluten-free"],servings:1,calories:220,emoji:"üçé"},
            {title:"Energy Balls",type:"snack",ingredients:["Dates","Oats","Peanut butter","Cocoa powder","Coconut"],mainIngredients:["dates","oats"],instructions:"1. Blend dates until sticky\n2. Add oats and peanut butter\n3. Add cocoa\n4. Mix well\n5. Roll into balls\n6. Coat in coconut, refrigerate",equipment:"Food processor",dietary:["vegan","dairy-free"],servings:12,calories:120,emoji:"üç´"},
            {title:"Guacamole with Tortilla Chips",type:"snack",ingredients:["Avocados","Lime","Tomato","Onion","Coriander","Tortilla chips"],mainIngredients:["avocado"],instructions:"1. Mash avocados\n2. Add lime juice\n3. Dice tomato and onion\n4. Mix in coriander\n5. Season well\n6. Serve with chips",equipment:"Bowl",dietary:["vegan","dairy-free"],servings:4,calories:220,emoji:"ü•ë"}
        ];

        // Initialize meals from sample data on first load
        function initializeSampleMeals() {
            const existingMeals = JSON.parse(localStorage.getItem('meals') || '[]');
            if (existingMeals.length === 0) {
                const mealsWithIds = sampleMeals.map((meal, index) => ({
                    id: `meal-${Date.now()}-${index}`,
                    ...meal,
                    favourite: false,
                    image: null,
                    dateAdded: new Date().toISOString()
                }));
                localStorage.setItem('meals', JSON.stringify(mealsWithIds));
            }
        }

        // Get all meals from storage
        function getMeals() {
            return JSON.parse(localStorage.getItem('meals') || '[]');
        }

        // Save meals to storage
        function saveMeals(meals) {
            localStorage.setItem('meals', JSON.stringify(meals));
        }

        // Generate unique ID
        function generateId() {
            return `meal-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
        }

        // Current filter state
        let currentFilters = {
            type: 'all',
            dietary: 'all',
            ingredient: 'all',
            search: '',
            favourites: false
        };

        // Render meals grid
        function renderMeals() {
            const meals = getMeals();
            const filtered = filterMeals(meals);
            const grid = document.getElementById('mealsGrid');
            const emptyState = document.getElementById('emptyState');
            const resultsCount = document.getElementById('resultsCount');

            resultsCount.textContent = `Showing ${filtered.length} recipe${filtered.length !== 1 ? 's' : ''}`;

            if (filtered.length === 0) {
                grid.style.display = 'none';
                emptyState.style.display = 'block';
            } else {
                grid.style.display = 'grid';
                emptyState.style.display = 'none';
                grid.innerHTML = filtered.map(meal => createMealCard(meal)).join('');
            }
        }

        // Filter meals based on current filters
        function filterMeals(meals) {
            return meals.filter(meal => {
                // Type filter
                if (currentFilters.type !== 'all' && meal.type !== currentFilters.type) {
                    return false;
                }

                // Dietary filter
                if (currentFilters.dietary !== 'all' && !meal.dietary.includes(currentFilters.dietary)) {
                    return false;
                }

                // Ingredient filter
                if (currentFilters.ingredient !== 'all') {
                    const hasIngredient = meal.mainIngredients.some(ing => 
                        ing.toLowerCase().includes(currentFilters.ingredient.toLowerCase())
                    );
                    if (!hasIngredient) return false;
                }

                // Search filter
                if (currentFilters.search) {
                    const searchLower = currentFilters.search.toLowerCase();
                    const titleMatch = meal.title.toLowerCase().includes(searchLower);
                    const ingredientMatch = meal.ingredients.some(ing => 
                        ing.toLowerCase().includes(searchLower)
                    );
                    if (!titleMatch && !ingredientMatch) return false;
                }

                // Favourites filter
                if (currentFilters.favourites && !meal.favourite) {
                    return false;
                }

                return true;
            });
        }

        // Create meal card HTML
        function createMealCard(meal) {
            const dietaryTags = meal.dietary.map(tag => 
                `<span class="dietary-tag ${tag}">${tag.replace('-', ' ')}</span>`
            ).join('');

            return `
                <div class="meal-card" onclick="viewMeal('${meal.id}')" role="listitem" tabindex="0" 
                     onkeypress="if(event.key==='Enter') viewMeal('${meal.id}')">
                    ${meal.favourite ? '<div class="favourite-icon">‚≠ê</div>' : ''}
                    <div class="meal-image">${meal.image ? `<img src="${meal.image}" alt="${meal.title}">` : meal.emoji}</div>
                    <div class="meal-content">
                        <h3 class="meal-title">${meal.title}</h3>
                        <span class="meal-type">${meal.type}</span>
                        <div class="meal-tags">${dietaryTags}</div>
                        ${meal.calories ? `<div class="meal-calories">${meal.calories} cal per serving</div>` : ''}
                    </div>
                </div>
            `;
        }

        // View meal details
        window.viewMeal = function(mealId) {
            const meals = getMeals();
            const meal = meals.find(m => m.id === mealId);
            if (!meal) return;

            const modal = document.getElementById('viewMealModal');
            const title = document.getElementById('viewMealTitle');
            const body = document.getElementById('viewMealBody');

            title.textContent = meal.title;

            const dietaryTags = meal.dietary.map(tag => 
                `<span class="dietary-tag ${tag}">${tag.replace('-', ' ')}</span>`
            ).join('');

            body.innerHTML = `
                <div class="view-meal-image">${meal.image ? `<img src="${meal.image}" alt="${meal.title}">` : meal.emoji}</div>
                
                <div style="margin-bottom: 1rem;">
                    <span class="meal-type">${meal.type}</span>
                    <div class="meal-tags" style="margin-top: 0.5rem;">${dietaryTags}</div>
                </div>

                ${meal.servings || meal.calories ? `
                    <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                        ${meal.servings ? `<div><strong>Servings:</strong> ${meal.servings}</div>` : ''}
                        ${meal.calories ? `<div><strong>Calories:</strong> ${meal.calories} per serving</div>` : ''}
                    </div>
                ` : ''}

                <div class="meal-detail-section">
                    <h3>Ingredients</h3>
                    <ul>
                        ${meal.ingredients.map(ing => `<li>${ing}</li>`).join('')}
                    </ul>
                </div>

                ${meal.mainIngredients && meal.mainIngredients.length > 0 ? `
                    <div class="meal-detail-section">
                        <h3>Main Ingredients</h3>
                        <p>${meal.mainIngredients.join(', ')}</p>
                    </div>
                ` : ''}

                <div class="meal-detail-section">
                    <h3>Instructions</h3>
                    <p style="white-space: pre-line;">${meal.instructions}</p>
                </div>

                ${meal.equipment ? `
                    <div class="meal-detail-section">
                        <h3>Equipment Needed</h3>
                        <p>${meal.equipment}</p>
                    </div>
                ` : ''}
            `;

            // Update buttons
            const toggleFavBtn = document.getElementById('toggleFavBtn');
            toggleFavBtn.textContent = meal.favourite ? '‚≠ê Unfavourite' : '‚≠ê Favourite';
            toggleFavBtn.onclick = () => toggleFavourite(mealId);

            const deleteMealBtn = document.getElementById('deleteMealBtn');
            deleteMealBtn.onclick = () => deleteMeal(mealId);

            modal.classList.add('active');
        };

        // Toggle favourite status
        function toggleFavourite(mealId) {
            const meals = getMeals();
            const meal = meals.find(m => m.id === mealId);
            if (meal) {
                meal.favourite = !meal.favourite;
                saveMeals(meals);
                renderMeals();
                // Update modal if open
                if (document.getElementById('viewMealModal').classList.contains('active')) {
                    viewMeal(mealId);
                }
            }
        }

        // Delete meal
        function deleteMeal(mealId) {
            if (!confirm('Are you sure you want to delete this recipe?')) return;
            
            const meals = getMeals();
            const filtered = meals.filter(m => m.id !== mealId);
            saveMeals(filtered);
            closeModal('viewMealModal');
            renderMeals();
        }

        // Open modal
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Populate ingredient filter
        function populateIngredientFilter() {
            const meals = getMeals();
            const ingredients = new Set();
            meals.forEach(meal => {
                meal.mainIngredients.forEach(ing => ingredients.add(ing.toLowerCase()));
            });

            const select = document.getElementById('ingredientFilter');
            const sorted = Array.from(ingredients).sort();
            
            select.innerHTML = '<option value="all">All Ingredients</option>' +
                sorted.map(ing => `<option value="${ing}">${ing.charAt(0).toUpperCase() + ing.slice(1)}</option>`).join('');
        }

        // Handle filter changes
        function setupFilters() {
            // Type filters
            document.querySelectorAll('[data-filter="type"]').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('[data-filter="type"]').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilters.type = btn.dataset.value;
                    renderMeals();
                });
            });

            // Dietary filters
            document.querySelectorAll('[data-filter="dietary"]').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('[data-filter="dietary"]').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilters.dietary = btn.dataset.value;
                    renderMeals();
                });
            });

            // Ingredient filter
            document.getElementById('ingredientFilter').addEventListener('change', (e) => {
                currentFilters.ingredient = e.target.value;
                renderMeals();
            });

            // Search with debounce
            let searchTimeout;
            document.getElementById('searchBox').addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    currentFilters.search = e.target.value;
                    renderMeals();
                }, 300);
            });

            // Favourites filter
            document.getElementById('favouritesBtn').addEventListener('click', function() {
                currentFilters.favourites = !currentFilters.favourites;
                this.classList.toggle('active');
                renderMeals();
            });
        }

        // Handle add meal form
        function setupAddMealForm() {
            const form = document.getElementById('addMealForm');
            const imageInput = document.getElementById('mealImage');
            const imagePreview = document.getElementById('imagePreview');

            // Image preview
            imageInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        imagePreview.src = e.target.result;
                        imagePreview.classList.add('active');
                    };
                    reader.readAsDataURL(file);
                }
            });

            // Form submission
            form.addEventListener('submit', (e) => {
                e.preventDefault();

                const dietary = Array.from(document.querySelectorAll('input[name="dietary"]:checked'))
                    .map(cb => cb.value);

                const newMeal = {
                    id: generateId(),
                    title: document.getElementById('mealTitle').value,
                    type: document.getElementById('mealType').value,
                    ingredients: document.getElementById('mealIngredients').value.split('\n').filter(i => i.trim()),
                    mainIngredients: document.getElementById('mealMainIngredients').value
                        .split(',').map(i => i.trim()).filter(i => i),
                    instructions: document.getElementById('mealInstructions').value,
                    equipment: document.getElementById('mealEquipment').value,
                    dietary: dietary,
                    servings: parseInt(document.getElementById('mealServings').value) || 2,
                    calories: parseInt(document.getElementById('mealCalories').value) || null,
                    favourite: document.getElementById('mealFavourite').checked,
                    image: imagePreview.classList.contains('active') ? imagePreview.src : null,
                    emoji: 'üçΩÔ∏è',
                    dateAdded: new Date().toISOString()
                };

                const meals = getMeals();
                meals.unshift(newMeal);
                saveMeals(meals);

                form.reset();
                imagePreview.classList.remove('active');
                closeModal('addMealModal');
                populateIngredientFilter();
                renderMeals();

                alert('Recipe added successfully!');
            });
        }

        // Setup modal controls
        function setupModals() {
            // Add meal modal
            document.getElementById('addMealBtn').addEventListener('click', () => {
                openModal('addMealModal');
            });

            document.getElementById('cancelAddBtn').addEventListener('click', () => {
                closeModal('addMealModal');
            });

            // Close buttons
            document.querySelectorAll('.modal-close').forEach(btn => {
                btn.addEventListener('click', function() {
                    this.closest('.modal').classList.remove('active');
                });
            });

            // Close meal view modal
            document.getElementById('closeMealBtn').addEventListener('click', () => {
                closeModal('viewMealModal');
            });

            // Click outside to close
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('active');
                    }
                });
            });

            // Escape key to close
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    document.querySelectorAll('.modal.active').forEach(modal => {
                        modal.classList.remove('active');
                    });
                }
            });
        }

        // Setup navigation toggle
        function setupNavigation() {
            const navToggle = document.querySelector('.nav-toggle');
            const navMenu = document.querySelector('.nav-menu');

            if (navToggle) {
                navToggle.addEventListener('click', () => {
                    const isExpanded = navToggle.getAttribute('aria-expanded') === 'true';
                    navToggle.setAttribute('aria-expanded', !isExpanded);
                    navMenu.classList.toggle('active');
                });
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initializeSampleMeals();
            setupNavigation();
            setupFilters();
            setupAddMealForm();
            setupModals();
            populateIngredientFilter();
            renderMeals();
        });
    </script>
</body>
</html>
