<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Shopping List - Home Hub</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --primary: #667eea;
            --primary-dark: #764ba2;
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --bg: #0f172a;
            --card: #1e293b;
            --text: #f1f5f9;
            --text-dim: #cbd5e1;
            --border: #334155;
            --accent: #f59e42;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }
        * { box-sizing: border-box; }
        .nav { background: var(--card); border-bottom: 1px solid var(--border); padding: 1rem 1.5rem; position: sticky; top: 0; z-index: 100;}
        .nav-content { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center;}
        .nav-brand { font-size: 1.5rem; font-weight: 800; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;}
        .nav-toggle {display:none;}
        .nav-menu {display:flex;gap:0.5rem;list-style:none;}
        .nav-menu a {padding:0.6rem 1.2rem; border-radius:8px; text-decoration:none; color:var(--text-dim); font-weight:600;font-size:0.95rem; transition:all 0.2s;}
        .nav-menu a:hover { background: rgba(102,126,234,0.1); color:var(--primary);}
        .nav-menu a.active { background: var(--gradient); color: white;}
        @media(max-width:768px){
            .nav-toggle{display:block;}
            .nav-menu{position:fixed;top:70px;left:0;right:0;background:var(--card);flex-direction:column;padding:1rem;transform:translateY(-100%);opacity:0;pointer-events:none;transition:all 0.3s;}
            .nav-menu.active{transform:translateY(0);opacity:1;pointer-events:all;}
            .nav-menu a{width:100%;}
        }
        .container { max-width: 1000px; margin: 0 auto; padding: 2rem 1.5rem;}
        h1 { font-size:2rem; background:var(--gradient); -webkit-background-clip:text; -webkit-text-fill-color:transparent; margin:0;}
        .controls { display: flex; gap: 0.7em; margin-bottom: 2em; flex-wrap:wrap;}
        .btn { padding:0.8rem 1.5rem; border-radius:8px; font-weight:600; cursor:pointer; border:none; background:var(--gradient); color:white; transition:all 0.2s;}
        .btn:hover{transform:translateY(-2px);}
        .btn-secondary{ background:var(--card); color:var(--primary); border:1px solid var(--border);}
        .btn-secondary:hover{ background:var(--primary); color:white;}
        .shopping-list-section {background:var(--card);border-radius:15px;padding:2rem 1.5rem;border:1px solid var(--border);}
        .section-title { font-size:1.2rem; font-weight:800; margin-bottom:1.2em; background:var(--gradient); -webkit-background-clip:text; -webkit-text-fill-color:transparent;}
        .add-row {display:flex;gap:0.7em;align-items:center;margin-bottom:1.2em;}
        .add-row input {padding:0.6em 1em; border-radius:7px; border:1px solid var(--border);font-size:1em; background:var(--bg); color:var(--text);}
        .add-row .btn {padding:0.6em 1.1em;}
        ul.shopping-list {list-style:none;margin:0;padding:0;}
        ul.shopping-list li {display:flex;align-items:center;gap:1em;padding:0.6em 0;border-bottom:1px solid var(--border);}
        ul.shopping-list li:last-child{border-bottom:none;}
        .shop-item-qty {color:var(--accent);margin-left:1.1em;}
        .shop-remove {color:#fff;background:#ef4444;border:none;border-radius:7px;padding:0.35em 1.3em;cursor:pointer;margin-left:auto;}
        .shop-fav {color:#f59e42;font-size:1.3em;margin-right:0.5em;cursor:pointer;}
        .shop-checked {text-decoration:line-through; color:var(--text-dim);}
        .empty { color: var(--text-dim); font-size:1.02rem;}
        @media(max-width:600px){
            .shopping-list-section {padding:1rem;}
        }
    </style>
</head>
<body>
<nav class="nav">
    <div class="nav-content">
        <div class="nav-brand">üè† Home Hub</div>
        <button class="nav-toggle" onclick="document.getElementById('navMenu').classList.toggle('active')">‚ò∞</button>
        <ul class="nav-menu" id="navMenu">
            <li><a href="../index.html">üìä Dashboard</a></li>
            <li><a href="meals.html">üçΩÔ∏è Meals</a></li>
            <li><a href="planner.html">üìÖ Planner</a></li>
            <li><a href="shopping.html" class="active">üõí Shopping</a></li>
            <li><a href="cleaning.html">üßπ Cleaning</a></li>
            <li><a href="maintenance.html">üõ†Ô∏è Maintenance</a></li>
            <li><a href="settings.html">‚öôÔ∏è Settings</a></li>
        </ul>
    </div>
</nav>
<div class="container">
    <h1>Shopping List</h1>
    <div class="controls">
        <button class="btn" onclick="generateShoppingListFromPlanner()">Merge Weekly Meals</button>
        <button class="btn" onclick="pullCleaningSupplies()">Pull Cleaning Supplies</button>
    </div>
    <div class="shopping-list-section">
        <div class="section-title">üõí Household Shopping List</div>
        <div class="add-row">
            <input type="text" id="shopInput" placeholder="Add item..." autocomplete="off">
            <input type="number" id="shopQty" placeholder="Qty" min="1" style="width:70px;" value="1">
            <button class="btn" onclick="addShoppingItem()">Add</button>
        </div>
        <ul class="shopping-list" id="shoppingList"></ul>
        <div class="empty" id="emptyList" style="display:none;">All done! No items in shopping list.</div>
    </div>
</div>
<script>
function getShopping(){
    return JSON.parse(localStorage.getItem('hubShopping')||'[]');
}
function saveShopping(list){
    localStorage.setItem('hubShopping', JSON.stringify(list));
}
function renderShoppingList(){
    const list = getShopping();
    const ul = document.getElementById('shoppingList');
    ul.innerHTML = '';
    if(list.length===0){
        document.getElementById('emptyList').style.display='block';
        return;
    }
    document.getElementById('emptyList').style.display='none';
    list.forEach((item, idx) => {
        ul.innerHTML += `
        <li>
            <span class="shop-fav" onclick="toggleFav(${idx})">${item.fav ? '‚≠ê' : '‚òÜ'}</span>
            <input type="checkbox" ${item.checked ? 'checked':''} onclick="toggleChecked(${idx})">
            <span class="${item.checked?'shop-checked':''}">${item.name}</span>
            <span class="shop-item-qty">${item.qty>1?`x${item.qty}`:''}</span>
            <button class="shop-remove" onclick="removeShoppingItem(${idx})">Remove</button>
        </li>
        `;
    });
}
function addShoppingItem(){
    let val = document.getElementById('shopInput').value.trim();
    let qty = parseInt(document.getElementById('shopQty').value)||1;
    if(!val) return;
    let list = getShopping();
    let existing = list.findIndex(i=>i.name.toLowerCase() === val.toLowerCase());
    if(existing>=0){
        list[existing].qty += qty;
    }else{
        list.push({name: val, qty:qty, fav:false, checked:false});
    }
    saveShopping(list);
    renderShoppingList();
    document.getElementById('shopInput').value = '';
    document.getElementById('shopQty').value = 1;
}
function removeShoppingItem(idx){
    let list = getShopping();
    list.splice(idx,1);
    saveShopping(list);
    renderShoppingList();
}
function toggleChecked(idx){
    let list = getShopping();
    list[idx].checked = !list[idx].checked;
    saveShopping(list);
    renderShoppingList();
}
function toggleFav(idx){
    let list = getShopping();
    list[idx].fav = !list[idx].fav;
    saveShopping(list);
    renderShoppingList();
}
function generateShoppingListFromPlanner(){
    let planner = JSON.parse(localStorage.getItem('hubPlanner')||'[]');
    let weekIngredients = [];
    planner.forEach(slotObj=>{
        Object.values(slotObj.slots||{}).forEach(meal=>{
            if(meal && meal.ing){
                weekIngredients.push(...meal.ing);
            }
        });
    });
    function parseIngredient(ingredient) {
        let parts = ingredient.trim().split(" ");
        if (parts.length>=2 && !isNaN(parts[0])) {
            return {name:parts.slice(1).join(" "), qty:Number(parts[0])};
        }
        return {name:ingredient.trim(), qty:1};
    }
    let merged = {};
    weekIngredients.forEach(i => {
        let {name, qty} = parseIngredient(i);
        let key = name.toLowerCase();
        if(name=='') return;
        if(merged[key]) merged[key].qty += qty;
        else merged[key]={name, qty};
    });
    let shopping = getShopping();
    Object.values(merged).forEach(({name,qty}) => {
        let idx = shopping.findIndex(i=>i.name.toLowerCase()===name.toLowerCase());
        if(idx>=0) {
            shopping[idx].qty = (shopping[idx].qty||1)+qty;
        } else {
            shopping.push({name, qty, fav:false, checked:false});
        }
    });
    saveShopping(shopping);
    alert("Weekly meals added to shopping list!");
    renderShoppingList();
}

// NEW: Pull Cleaning Supplies
function pullCleaningSupplies() {
    // Get equipment/cleaning supplies from cleaning page's localStorage
    const equipment = JSON.parse(localStorage.getItem('hubCleaningEquipment') || "[]");
    if(!equipment || !equipment.length){
        alert("No cleaning supplies found.");
        return;
    }
    let shopping = getShopping();

    equipment.forEach(item => {
        if (!shopping.some(s => s.name.toLowerCase() === item.toLowerCase())) {
            shopping.push({ name: item, qty: 1, fav: false, checked: false });
        }
    });

    saveShopping(shopping);
    renderShoppingList();
    alert("Cleaning supplies added to Shopping List!");
}

// INIT
window.addEventListener('DOMContentLoaded',renderShoppingList);
</script>
</body>
</html>
