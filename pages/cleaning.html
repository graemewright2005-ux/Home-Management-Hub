<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cleaning & Home Management Schedule - Home Hub</title>
    <style>
        :root {
            --primary: #667eea;
            --primary-dark: #764ba2;
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --bg: #0f172a;
            --card: #1e293b;
            --text: #f1f5f9;
            --text-dim: #cbd5e1;
            --border: #334155;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }
        .nav {
            background: var(--card);
            border-bottom: 1px solid var(--border);
            padding: 1rem 1.5rem;
            position: sticky; top: 0; z-index: 100;
        }
        .nav-content {
            max-width: 1400px; margin: 0 auto;
            display: flex; justify-content: space-between; align-items: center;
        }
        .nav-brand { font-size: 1.5rem; font-weight: 800; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .nav-toggle { display: none; background: none; border: none; color: var(--primary); font-size: 1.5rem; cursor: pointer; padding: 0.5rem; }
        .nav-menu { display: flex; gap: 0.5rem; list-style: none; }
        .nav-menu a { padding: 0.6rem 1.2rem; border-radius: 8px; text-decoration: none; color: var(--text-dim); font-weight: 600; font-size: 0.95rem; transition: all 0.2s; }
        .nav-menu a:hover { background: rgba(102, 126, 234, 0.1); color: var(--primary); }
        .nav-menu a.active { background: var(--gradient); color: white; }
        @media (max-width: 768px) {
            .nav-toggle { display: block; }
            .nav-menu { position: fixed; top: 70px; left: 0; right: 0; background: var(--card); flex-direction: column; padding: 1rem; transform: translateY(-100%); opacity: 0; pointer-events: none; transition: all 0.3s; }
            .nav-menu.active { transform: translateY(0); opacity: 1; pointer-events: all; }
            .nav-menu a { width: 100%; }
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 2rem 1.5rem; }
        h1 { font-size: 2rem; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 0 0 1rem 0; }
        .calendar-section { background: var(--card); border-radius: 12px; border: 1px solid var(--border); padding: 1.5rem; margin-bottom: 2rem; }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .calendar-head-month { font-size: 1.3rem; font-weight: 600; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .calendar-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.97rem; }
        .calendar-table th, .calendar-table td { border: 1px solid var(--border); padding: 8px; text-align: left; }
        .calendar-table th { background: var(--gradient); color: white; }
        .calendar-table .am, .calendar-table .pm { width: 30%; vertical-align: top; }
        .calendar-table .weekday { width: 90px; font-weight: 600; }
        .calendar-table .date { width: 80px; color: var(--text-dim);}
        .calendar-table .tick-task { display: flex; align-items: center; gap: 0.7em; }
        .calendar-table .completed { text-decoration: line-through; color: gray; }
        .calendar-table .slot-btn { background: var(--primary); color: white; padding: 2px 8px; border-radius: 7px; border: none; font-size: 0.98em; cursor: pointer; margin-top:2px;}
        .calendar-table .slot-btn:active { background: var(--primary-dark);}
        .calendar-table .taskcard-in-slot { margin-bottom: 5px;}
        .calendar-table input[type="checkbox"] { accent-color: var(--primary); }
        @media (max-width: 950px) {
            .calendar-table, .calendar-table thead, .calendar-table tbody, .calendar-table th, .calendar-table td { display: block; width: 100%; }
            .calendar-table tr { margin-bottom: 12px; border-radius: 7px; background: var(--card); }
            .calendar-table th, .calendar-table td { padding: 7px !important; min-height: 36px;}
        }
        .filters-section { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem; }
        .filter-row { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; margin-bottom: 8px;}
        .filter-label { font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; font-size: 0.93em; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        select, input[type="search"], input[type="text"] { padding: 0.7em 1em; background: var(--bg); border: 2px solid var(--border); border-radius: 8px; color: var(--text); font-size: 1rem; }
        .taskcards-section { margin-bottom: 36px;}
        .cards-list { display: flex; flex-wrap: wrap; gap: 1.2em; }
        .task-card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; min-width: 240px; max-width:330px; padding: 1em 1em 1em 1.2em; display: flex; flex-direction: column; cursor: pointer; }
        .task-card-title { font-weight: 600; font-size: 1.08rem; margin-bottom: 0.45em; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;}
        .task-card-details { color: var(--text-dim); font-size: 0.98em;}
        .task-card-freq {font-weight:600;}
        .task-card-btn { margin-top: 8px; align-self: flex-end; background: var(--gradient); color: white; border: none; padding: 4px 13px; border-radius: 6px; font-size: 0.96em; cursor: pointer;}
        .task-card-btn:active { background: var(--primary-dark);}
        .hidden { display:none!important;}
        .manual-section { background: var(--card); border-radius: 10px; border: 1px solid var(--border); padding: 1.4em 1.1em; margin-bottom: 2em;}
        .manual-row { display: flex; flex-wrap: wrap; gap: 1.1em; margin-bottom:0.6em;}
        .manual-label { font-weight:600; margin-right:0.5em;}
        .manual-input { padding:6px 1em; border-radius:8px; border: 1px solid var(--border); background: var(--bg); color: var(--text);}
        .manual-btn { background: var(--gradient); color: white; border: none; border-radius: 7px; padding: 6px 25px; font-size: 1em; font-weight:600; margin-top:8px; cursor:pointer; }
        .manual-btn:active { background: var(--primary-dark);}
        .manual-section h3 { background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom:5px;}
        .shopping-section { background: var(--card); border-radius: 10px; border: 1px solid var(--border); padding: 1em 1.1em; margin-bottom: 2em;}
        .shopping-section h3 { background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom:4px;}
        .shopping-row { display:flex; gap:0.7em; margin-bottom:8px;}
        .shopping-input { padding:6px 1em; border-radius:8px; border: 1px solid var(--border); background: var(--bg); color: var(--text);}
        .shopping-btn { background: var(--gradient); color: white; border: none; border-radius: 7px; padding: 5px 16px; font-size: 0.98em; cursor:pointer; }
        .shopping-btn:active { background: var(--primary-dark);}
        .shopping-list { list-style:none; padding: 0; margin: 0;}
        .shopping-item { display: flex; justify-content: space-between; align-items: center; padding: 4px 2px;}
        .shopping-delete { background: #ef4444; color: white; border: none; border-radius: 4px; font-size: 0.92em; padding: 0 8px; cursor: pointer;}
        .shopping-delete:active { background:#dc2626;}
        .empty { text-align: center; padding: 2.2rem 1rem; color: var(--text-dim); }
        .empty-icon { font-size: 3rem; margin-bottom: 1rem; opacity: 0.4; }
        @media (max-width: 550px) {
            h1 { font-size: 1.3rem;}
            .calendar-header {flex-direction:column;}
            .manual-row,.shopping-row,.filter-row { flex-direction:column;}
            .task-card { min-width:180px; max-width:98vw;}
        }
    </style>
</head>
<body>
<nav class="nav">
    <div class="nav-content">
        <div class="nav-brand">üè† Home Hub</div>
        <button class="nav-toggle" onclick="document.getElementById('navMenu').classList.toggle('active')">‚ò∞</button>
        <ul class="nav-menu" id="navMenu">
            <li><a href="../index.html">üìä Dashboard</a></li>
            <li><a href="meals.html">üçΩÔ∏è Meals</a></li>
            <li><a href="planner.html">üìÖ Planner</a></li>
            <li><a href="shopping.html">üõí Shopping</a></li>
            <li><a href="cleaning.html" class="active">üßπ Cleaning</a></li>
            <li><a href="maintenance.html">üõ†Ô∏è Maintenance</a></li>
            <li><a href="settings.html">‚öôÔ∏è Settings</a></li>
        </ul>
    </div>
</nav>
<div class="container">

    <h1>Cleaning & Home Management Schedule</h1>
    <div class="calendar-section">
        <div class="calendar-header">
            <div class="calendar-head-month" id="calendarMonth"></div>
            <div>
                <button class="manual-btn" onclick="prevMonth()">&lt; Prev</button>
                <button class="manual-btn" onclick="nextMonth()">Next &gt;</button>
            </div>
        </div>
        <table class="calendar-table" id="calendar-table">
            <!-- Calendar will be rendered here -->
        </table>
    </div>

    <!-- "Tasks to add" section, appears below calendar FIRST upon loading -->
    <div class="taskcards-section">
        <h3 class="filter-label">Tasks to Add to Calendar</h3>
        <div class="filters-section">
            <div class="filter-row">
                <div>
                    <span class="filter-label">Filter by Room</span>
                    <select id="taskFilterRoom" onchange="updateTaskCards()">
                        <option value="">Select...</option>
                        <option value="kitchen">Kitchen</option>
                        <option value="bathroom">Bathroom</option>
                        <option value="living">Living Area</option>
                        <option value="bedroom">Bedroom</option>
                        <option value="outdoor">Outdoor/Garden</option>
                        <option value="car">Car</option>
                    </select>
                </div>
                <div>
                    <span class="filter-label">Filter by Frequency</span>
                    <select id="taskFilterFreq" onchange="updateTaskCards()">
                        <option value="">Select...</option>
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="fortnightly">Bi-Weekly</option>
                        <option value="monthly">Monthly</option>
                        <option value="seasonal">Seasonal</option>
                    </select>
                </div>
            </div>
        </div>
        <div id="taskCards" class="cards-list"></div>
        <div id="emptyCards" class="empty hidden">
            <div class="empty-icon">üßπ</div>
            <h3>No tasks found for your filter.</h3>
        </div>
    </div>

    <!-- Manual Add -->
    <div class="manual-section">
        <h3>Manual Add Cleaning Task</h3>
        <form id="manualForm" onsubmit="addManualTask(event)">
            <div class="manual-row">
                <label class="manual-label">Task Name:
                    <input required type="text" name="manualTaskName" class="manual-input" id="manualTaskName" placeholder="E.g. Clean vents"/>
                </label>
                <label class="manual-label">Room:
                    <select name="manualTaskRoom" id="manualTaskRoom" class="manual-input">
                        <option value="kitchen">Kitchen</option>
                        <option value="bathroom">Bathroom</option>
                        <option value="living">Living Area</option>
                        <option value="bedroom">Bedroom</option>
                        <option value="outdoor">Outdoor/Garden</option>
                        <option value="car">Car</option>
                    </select>
                </label>
                <label class="manual-label">Frequency:
                    <select name="manualTaskFreq" id="manualTaskFreq" class="manual-input">
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="fortnightly">Bi-Weekly</option>
                        <option value="monthly">Monthly</option>
                        <option value="seasonal">Seasonal</option>
                    </select>
                </label>
                <input type="text" id="manualTaskDetail" class="manual-input" placeholder="One detail per line (optional)">
            </div>
            <button class="manual-btn" type="submit">Add Task</button>
        </form>
    </div>

    <!-- Shopping List Add -->
    <div class="shopping-section">
        <h3>Add Equipment / Cleaning Supplies to Shopping List</h3>
        <form onsubmit="addShoppingItem(event)">
            <div class="shopping-row">
                <input required type="text" id="shoppingInput" class="shopping-input" placeholder="E.g. Toilet Duck, Cleaner...">
                <button class="shopping-btn" type="submit">Add</button>
            </div>
        </form>
        <ul class="shopping-list" id="shoppingList"></ul>
    </div>
</div>

<script>
const PREPOPULATED_TASKS = [
    {title:"Wash dishes", freq:"daily", room:"kitchen", details:["Rinse dishes","Use dishwasher or handwash"]},
    {title:"Wipe kitchen counters", freq:"daily", room:"kitchen", details:["Clear surfaces","Disinfect thoroughly"]},
    {title:"Clean bathroom sink", freq:"daily", room:"bathroom", details:["Wipe with cleaner","Rinse well"]},
    {title:"Make beds", freq:"daily", room:"bedroom", details:["Straighten sheets","Fluff pillows"]},
    {title:"Vacuum floors", freq:"weekly", room:"living", details:["Vacuum main living area","Edges and corners"]},
    {title:"Clean bathrooms", freq:"weekly", room:"bathroom", details:["Scrub toilet","Wipe shower/tub surfaces"]},
    {title:"Bins out", freq:"weekly", room:"outdoor", details:["Collect all bins","Move to kerb"]},
    {title:"Mop floors", freq:"fortnightly", room:"kitchen", details:["Sweep before mopping","Use mop and cleaner"]},
    {title:"Clean fridge", freq:"fortnightly", room:"kitchen", details:["Remove old food","Wipe shelves/compartments"]},
    {title:"Oven clean", freq:"monthly", room:"kitchen", details:["Remove racks","Scrub interior"]},
    {title:"Wash windows", freq:"monthly", room:"living", details:["Spray windows","Dry with towel"]},
    {title:"Deep clean", freq:"monthly", room:"living", details:["Move furniture","Clean under"]},
    {title:"Gutters clear", freq:"seasonal", room:"outdoor", details:["Check gutters","Remove leaves/debris"]},
    {title:"Garden maintenance", freq:"seasonal", room:"outdoor", details:["Mow lawn","Trim hedges"]},
    {title:"Car service", freq:"seasonal", room:"car", details:["Check oil","Inspect tyres"]},
];
let calendarTasks=[]; // {date,part:["AM"|"PM"],tasks:[array of task objects]}
let allTasks=[];
let shoppingList=[];

function saveAll(){
    localStorage.setItem('hmhCleaningAllTasks', JSON.stringify(allTasks));
    localStorage.setItem('hmhCleaningCalendarTasks', JSON.stringify(calendarTasks));
    localStorage.setItem('hmhShoppingList', JSON.stringify(shoppingList));
}
function loadAll(){
    let d = localStorage.getItem('hmhCleaningAllTasks');
    allTasks = d ? JSON.parse(d) : [...PREPOPULATED_TASKS];
    let c = localStorage.getItem('hmhCleaningCalendarTasks');
    calendarTasks = c ? JSON.parse(c) : [];
    let sl = localStorage.getItem('hmhShoppingList');
    shoppingList = sl ? JSON.parse(sl): [];
}
function addManualTask(e){
    e.preventDefault();
    let name = document.getElementById("manualTaskName").value.trim();
    let room = document.getElementById("manualTaskRoom").value;
    let freq = document.getElementById("manualTaskFreq").value;
    let details = document.getElementById("manualTaskDetail").value.trim().split('\n').filter(d=>d.trim());
    if(!name) return;
    allTasks.push({title:name, freq:freq, room:room, details:details});
    saveAll(); updateTaskCards();
    document.getElementById("manualForm").reset();
}
function addShoppingItem(e){
    e.preventDefault();
    let val = document.getElementById("shoppingInput").value.trim();
    if(!val) return;
    shoppingList.push(val); saveAll(); renderShoppingList();
    document.getElementById("shoppingInput").value="";
}
function removeShoppingItem(idx){
    shoppingList.splice(idx,1); saveAll(); renderShoppingList();
}
function renderShoppingList(){
    let list = document.getElementById('shoppingList');
    list.innerHTML = shoppingList.map((item,i)=>`<li class="shopping-item">${item} <button class="shopping-delete" onclick="removeShoppingItem(${i})">Remove</button></li>`).join('');
}

function updateTaskCards(){
    let cards = document.getElementById('taskCards');
    let room = document.getElementById('taskFilterRoom').value;
    let freq = document.getElementById('taskFilterFreq').value;
    let filtered = allTasks.filter(t=>{
        if(room && t.room !== room) return false;
        if(freq && ((freq==='fortnightly'?"bi-weekly":freq)!==t.freq && freq!=="bi-weekly")) return false;
        return true;
    });
    cards.innerHTML = filtered.map((t,i)=>`
        <div class="task-card" onclick="openAddToCalendarModal(${i})">
            <div class="task-card-title">${t.title}</div>
            <div class="task-card-details">
                <span class="task-card-freq">${t.freq.charAt(0).toUpperCase()+t.freq.slice(1)}</span> ‚Ä¢ 
                ${t.room.charAt(0).toUpperCase()+t.room.slice(1).replace('living','Living Area').replace('outdoor','Outdoor/Garden').replace('car','Car')}
            </div>
            <ul style="margin:0.7em 0 0 0.6em;">
                ${t.details.map(d=>`<li>${d}</li>`).join("")}
            </ul>
            <button class="task-card-btn" onclick="event.stopPropagation();openAddToCalendarModal(${i});">Add to Calendar</button>
        </div>
    `).join('');
    document.getElementById('emptyCards').classList.toggle('hidden', filtered.length>0);
}

function openAddToCalendarModal(idx){
    let t = allTasks[idx];
    let day = prompt("Enter calendar day (1-30):", new Date().getDate());
    if(!day || isNaN(day)||day<1||day>31)return;
    let part = prompt("Assign to AM or PM?", "AM");
    part = part.toUpperCase()=="PM" ? "PM":"AM";
    // Find calendarTask entry for the date/part
    let dateStr = `${calendarYear}-${String(calendarMonth+1).padStart(2,"0")}-${String(day).padStart(2,"0")}`;
    let found = calendarTasks.find(c=>c.date==dateStr&&c.part==part);
    if(!found){
        found = {date:dateStr,part:part,tasks:[]}; calendarTasks.push(found);
    }
    found.tasks.push(t);
    saveAll(); renderCalendar();
}

let calendarMonth = 10; // November idx
let calendarYear = 2025;

function prevMonth(){
    if(calendarMonth==0){calendarMonth=11;calendarYear-=1;}
    else calendarMonth--;
    renderCalendar();
}

function nextMonth(){
    if(calendarMonth==11){calendarMonth=0;calendarYear+=1;}
    else calendarMonth++;
    renderCalendar();
}

function renderCalendar(){
    let table = document.getElementById("calendar-table");
    // Force November 2025 by default
    let monthIdx = calendarMonth;
    let year = calendarYear;
    document.getElementById("calendarMonth").innerHTML = 
        new Date(year,monthIdx,1).toLocaleString('default',{month:'long',year:'numeric'});
    // Generate: down left = day + date (e.g. Wed / 12th)
    // Across top: AM Tasks / PM Tasks
    let daysInMonth = new Date(year,monthIdx+1,0).getDate();
    table.innerHTML = `
        <thead>
            <tr>
                <th class="weekday">Day</th>
                <th class="date">Date</th>
                <th class="am">AM Tasks</th>
                <th class="pm">PM Tasks</th>
            </tr>
        </thead>
        <tbody>
            ${Array.from({length: daysInMonth}, (_,i)=>{
                let dt = new Date(year,monthIdx,i+1);
                let dateStr = `${year}-${String(monthIdx+1).padStart(2,"0")}-${String(i+1).padStart(2,"0")}`;
                let am = (calendarTasks.find(ct=>ct.date==dateStr&&ct.part=="AM")||{tasks:[]}).tasks;
                let pm = (calendarTasks.find(ct=>ct.date==dateStr&&ct.part=="PM")||{tasks:[]}).tasks;
                return `
                <tr>
                    <td class="weekday">${dt.toLocaleString('default',{weekday:'short'})}</td>
                    <td class="date">${dt.getDate()}${ordinal(dt.getDate())}</td>
                    <td class="am">${am.map((task,j)=>renderTaskInSlot(task,dateStr,"AM",j)).join('')}</td>
                    <td class="pm">${pm.map((task,j)=>renderTaskInSlot(task,dateStr,"PM",j)).join('')}</td>
                </tr>
                `
            }).join("")}
        </tbody>
    `;
}

function ordinal(n){
    if (n>3&&n<21) return "th";
    switch(n%10){
        case 1: return "st";
        case 2: return "nd";
        case 3: return "rd";
        default: return "th";
    }
}
function renderTaskInSlot(task,date,part,idx){
    let completed = getCompletion(date,part,idx);
    return `<div class="taskcard-in-slot">
        <label class="tick-task"><input type="checkbox" ${completed?'checked':''} onclick="tickTask('${date}','${part}',${idx},this)"> <span class="${completed?'completed':''}">${task.title}</span></label>
        <div style="color:var(--text-dim);margin-left:1.2em; font-size:0.95em;">${task.details.join(", ")}</div>
    </div>`;
}
function tickTask(date,part,idx,el){
    let key = `done_${date}_${part}_${idx}`;
    localStorage.setItem(key, el.checked?"yes":"");
    renderCalendar();
}
function getCompletion(date,part,idx){
    let key = `done_${date}_${part}_${idx}`;
    return localStorage.getItem(key)=="yes";
}

// Dashboard fetch for Today's tasks ‚Äî makes available via window.todayCleaningTasks
(function pushTodaysTasksToDashboard(){
    let today = new Date();
    if(today.getFullYear()!=calendarYear || today.getMonth()!=calendarMonth) return;
    let todayStr = `${calendarYear}-${String(calendarMonth+1).padStart(2,"0")}-${String(today.getDate()).padStart(2,"0")}`;
    let am = (calendarTasks.find(ct=>ct.date==todayStr&&ct.part=="AM")||{tasks:[]}).tasks;
    let pm = (calendarTasks.find(ct=>ct.date==todayStr&&ct.part=="PM")||{tasks:[]}).tasks;
    window.todayCleaningTasks = am.concat(pm).map(t=>t.title);
})();

document.addEventListener("DOMContentLoaded", ()=>{
    loadAll();
    updateTaskCards();
    renderCalendar();
    renderShoppingList();
});
</script>
</body>
</html>
