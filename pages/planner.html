<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Meal Planner - Home Hub</title>
    <style>
        :root {
            --primary: #667eea;
            --primary-dark: #764ba2;
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --bg: #0f172a;
            --card: #1e293b;
            --text: #f1f5f9;
            --text-dim: #cbd5e1;
            --border: #334155;
            --accent: #f59e42;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; }
        * { box-sizing: border-box; margin: 0; padding: 0;}
        .nav { background: var(--card); border-bottom: 1px solid var(--border); padding: 1rem 1.5rem; position: sticky; top: 0; z-index: 100;}
        .nav-content { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center;}
        .nav-brand { font-size: 1.5rem; font-weight: 800; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;}
        .nav-toggle {display:none;}
        .nav-menu {display:flex;gap:0.5rem;list-style:none;}
        .nav-menu a {padding:0.6rem 1.2rem; border-radius:8px; text-decoration:none; color:var(--text-dim); font-weight:600;font-size:0.95rem; transition:all 0.2s;}
        .nav-menu a:hover { background: rgba(102,126,234,0.1); color:var(--primary);}
        .nav-menu a.active { background: var(--gradient); color: white; }
        @media(max-width:768px){
            .nav-toggle{display:block;}
            .nav-menu{position:fixed;top:70px;left:0;right:0;background:var(--card);flex-direction:column;padding:1rem;transform:translateY(-100%);opacity:0;pointer-events:none;transition:all 0.3s;}
            .nav-menu.active{transform:translateY(0);opacity:1;pointer-events:all;}
            .nav-menu a{width:100%;}
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 2rem 1.5rem;}
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap:1rem;}
        h1 { font-size:2rem; background:var(--gradient); -webkit-background-clip:text; -webkit-text-fill-color:transparent; margin:0;}
        .planner-table { width:100%; border-collapse:collapse; margin-bottom:2rem;}
        th,td { border:1px solid var(--border); padding:1rem; background:var(--card);}
        th { background:var(--gradient); -webkit-background-clip:text; -webkit-text-fill-color:transparent; font-size:1rem;}
        .planner-action { display:flex; gap:0.7rem; margin-bottom:2rem;}
        .btn { padding:0.8rem 1.5rem; border-radius:8px; font-weight:600; cursor:pointer; border:none; background:var(--gradient); color:white; transition:all 0.2s;}
        .btn:hover{transform:translateY(-2px);}
        .btn-secondary{ background:var(--card); color:var(--primary); border:1px solid var(--border);}
        .btn-secondary:hover{ background:var(--primary); color:white;}
        .meal-cell-content { display:flex; align-items:center; gap:0.6em; margin-bottom:0.15em; }
        .meal-emoji { font-size:1.7em; margin-right:0.25em; }
        .meal-title { font-weight:700; background:var(--gradient); -webkit-background-clip:text; -webkit-text-fill-color:transparent; margin-right:0.4em;}
        .meal-type {font-size:0.92em; color:var(--text-dim);font-style:italic;background:rgba(102,126,234,0.13);border-radius:3px; padding:0 0.5em;}
        .meal-diet {font-size:0.92em; color:#ea580c;background:rgba(245,158,66,0.13);border-radius:3px; padding:0 0.5em; margin-left:0.3em;}
        .ingredients-list { display:block; font-size:0.97em; color: var(--text-dim); margin-left:2.2em; margin-top:-0.28em;}
        .empty { color: var(--text-dim); font-size:1.02rem;}
        .meal-select {width:90%;margin-bottom:0.3em;}
        @media(max-width:660px){
            th, td { padding:0.4rem;}
            .ingredients-list { margin-left:0.8em;}
        }
        .clear-link {color:var(--primary);cursor:pointer;font-size:0.98em;background:none;border:none;}
        .clear-link:hover{text-decoration:underline;}
    </style>
</head>
<body>
<nav class="nav">
    <div class="nav-content">
        <div class="nav-brand">üè† Home Hub</div>
        <button class="nav-toggle" onclick="document.getElementById('navMenu').classList.toggle('active')">‚ò∞</button>
        <ul class="nav-menu" id="navMenu">
            <li><a href="../index.html">üìä Dashboard</a></li>
            <li><a href="meals.html">üçΩÔ∏è Meals</a></li>
            <li><a href="planner.html" class="active">üìÖ Planner</a></li>
            <li><a href="shopping.html">üõí Shopping</a></li>
            <li><a href="cleaning.html">üßπ Cleaning</a></li>
            <li><a href="maintenance.html">üõ†Ô∏è Maintenance</a></li>
            <li><a href="settings.html">‚öôÔ∏è Settings</a></li>
        </ul>
    </div>
</nav>
<div class="container">
    <div class="header">
        <h1>Weekly Meal Planner</h1>
        <div class="planner-action">
            <button class="btn" onclick="generateShoppingListFromPlanner()">Generate Shopping List</button>
            <a href="shopping.html"><button class="btn-secondary">Go To Shopping List</button></a>
        </div>
    </div>
    <table class="planner-table">
        <thead>
            <tr>
                <th style="width:110px;">Day</th>
                <th>Meal</th>
                <th>Ingredients</th>
            </tr>
        </thead>
        <tbody id="plannerRows"></tbody>
    </table>
    <div class="empty" id="emptyPlanner" style="display:none;">No meals planned this week. Add meals using the Meals page or manually below.</div>
</div>
<script>
const WEEKDAYS = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
const MEAL_TIMES = ["Breakfast", "Lunch", "Dinner", "Snack"];
const meals = JSON.parse(localStorage.getItem('hubMeals')||'[]');
function getMealOptions(){
    return meals.map(m=>`<option value="${m.id}">${m.title} (${m.type})</option>`).join('');
}
function loadPlanner(){
    let planner = JSON.parse(localStorage.getItem('hubPlanner')||'[]');
    while(planner.length<7){ planner.push({slots:{}});}
    for(let i=0;i<7;i++){
        if(!planner[i].slots) planner[i].slots={};
    }
    return planner;
}
function savePlanner(planner){ localStorage.setItem('hubPlanner', JSON.stringify(planner)); }

function renderPlanner(){
    let planner = loadPlanner();
    let rows = '';
    let isEmpty = true;

    for(let i=0;i<7;i++){
        let slot = planner[i].slots;
        let mealCells = '';
        MEAL_TIMES.forEach(mt=>{
            let mealObj = slot[mt] ? meals.find(m=>m.id === slot[mt].id) || slot[mt] : null;
            let mealPreview = '';
            if(mealObj && mealObj.title){
                isEmpty = false;
                mealPreview = `
                    <div class="meal-cell-content">
                        <span class="meal-emoji">${mealObj.emoji||""}</span>
                        <span class="meal-title">${mealObj.title}</span>
                        <span class="meal-type">${mt.toLowerCase()}</span>
                        ${mealObj.diet && mealObj.diet.length ? `<span class="meal-diet">${mealObj.diet.join(', ')}</span>`:''}
                        <button class="clear-link" onclick="clearMeal(event, ${i}, '${mt}')">Clear</button>
                    </div>
                `;
            } else {
                mealPreview = `
                    <div class="meal-cell-content">
                        <select class="meal-select" onchange="setMeal(${i},'${mt}',this.value)">
                            <option value="">Select ${mt}</option>${getMealOptions()}
                        </select>
                    </div>
                `;
            }
            let ingPreview = (mealObj && mealObj.ing && mealObj.ing.length)
                ? `<div class="ingredients-list">${mealObj.ing.join(', ')}</div>`
                : '';
            mealCells += `<div style="margin-bottom:0.35em;">
                <strong>${mt}:</strong>
                ${mealPreview}
                ${ingPreview}
            </div>`;
        });

        rows += `<tr>
            <td>${WEEKDAYS[i]}</td>
            <td style="padding:1em 1em 1em 0.7em;">${mealCells}</td>
            <td></td>
        </tr>`;
    }
    document.getElementById('plannerRows').innerHTML = rows;
    document.getElementById('emptyPlanner').style.display = isEmpty ? "block":"none";
    let plannerData = loadPlanner();
    let selects = document.querySelectorAll('.meal-select');
    selects.forEach((s,idx) => {
        let day = Math.floor(idx/MEAL_TIMES.length);
        let time = MEAL_TIMES[idx%MEAL_TIMES.length];
        let id = plannerData[day] && plannerData[day].slots[time] && plannerData[day].slots[time].id ? plannerData[day].slots[time].id : "";
        s.value = id;
    });
}
function setMeal(day, mt, mealId){
    let planner = loadPlanner();
    let mealObj = meals.find(m=>m.id === mealId);
    if(!planner[day].slots) planner[day].slots={};
    planner[day].slots[mt] = mealObj ? {...mealObj} : null;
    savePlanner(planner);
    renderPlanner();
}
function clearMeal(event, day, mt){
    event.stopPropagation();
    let planner = loadPlanner();
    if(!planner[day].slots) planner[day].slots={};
    planner[day].slots[mt] = null;
    savePlanner(planner);
    renderPlanner();
}
function generateShoppingListFromPlanner() {
    let planner = loadPlanner();
    let weekIngredients = [];
    planner.forEach(slotObj=>{
        Object.values(slotObj.slots||{}).forEach(meal=>{
            if(meal && meal.ing){
                weekIngredients.push(...meal.ing);
            }
        });
    });
    function parseIngredient(ingredient) {
        let parts = ingredient.trim().split(" ");
        if (parts.length>=2 && !isNaN(parts[0])) {
            return {name:parts.slice(1).join(" "), qty:Number(parts[0])};
        }
        return {name:ingredient.trim(), qty:1};
    }
    let merged = {};
    weekIngredients.forEach(i => {
        let {name, qty} = parseIngredient(i);
        let key = name.toLowerCase();
        if(name=='') return;
        if(merged[key]) merged[key].qty += qty;
        else merged[key]={name, qty};
    });
    let shopping = JSON.parse(localStorage.getItem('hubShopping')||'[]');
    Object.values(merged).forEach(({name,qty}) => {
        let idx = shopping.findIndex(i=>i.name.toLowerCase()===name.toLowerCase());
        if(idx>=0) {
            shopping[idx].qty = (shopping[idx].qty||1)+qty;
        } else {
            shopping.push({name, qty, fav:false, checked:false});
        }
    });
    localStorage.setItem('hubShopping', JSON.stringify(shopping));
    alert("Weekly meals added to shopping list!");
}
renderPlanner();
</script>
</body>
</html>
