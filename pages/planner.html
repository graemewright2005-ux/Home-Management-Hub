<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Meal Planner - Home Hub</title>
    <style>
        :root {
            --primary: #667eea;
            --primary-dark: #764ba2;
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --bg: #0f172a;
            --card: #1e293b;
            --text: #f1f5f9;
            --text-dim: #cbd5e1;
            --border: #334155;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; }
        * { box-sizing: border-box; margin: 0; padding: 0;}
        .nav { background: var(--card); border-bottom: 1px solid var(--border); padding: 1rem 1.5rem; position: sticky; top: 0; z-index: 100;}
        .nav-content { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center;}
        .nav-brand { font-size: 1.5rem; font-weight: 800; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;}
        .nav-toggle {display:none;}
        .nav-menu {display:flex;gap:0.5rem;list-style:none;}
        .nav-menu a {padding:0.6rem 1.2rem; border-radius:8px; text-decoration:none; color:var(--text-dim); font-weight:600;font-size:0.95rem; transition:all 0.2s;}
        .nav-menu a:hover { background: rgba(102,126,234,0.1); color:var(--primary);}
        .nav-menu a.active { background: var(--gradient); color: white; }
        @media(max-width:768px){
            .nav-toggle{display:block;}
            .nav-menu{position:fixed;top:70px;left:0;right:0;background:var(--card);flex-direction:column;padding:1rem;transform:translateY(-100%);opacity:0;pointer-events:none;transition:all 0.3s;}
            .nav-menu.active{transform:translateY(0);opacity:1;pointer-events:all;}
            .nav-menu a{width:100%;}
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 2rem 1.5rem;}
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap:1rem;}
        h1 { font-size:2rem; background:var(--gradient); -webkit-background-clip:text; -webkit-text-fill-color:transparent; margin:0;}
        .planner-table { width:100%; border-collapse:collapse; margin-bottom:2rem;}
        th,td { border:1px solid var(--border); padding:1rem; background:var(--card);}
        th { background:var(--gradient); -webkit-background-clip:text; -webkit-text-fill-color:transparent; font-size:1rem;}
        .planner-action { display:flex; gap:0.7rem; margin-bottom:2rem;}
        .btn { padding:0.8rem 1.5rem; border-radius:8px; font-weight:600; cursor:pointer; border:none; background:var(--gradient); color:white; transition:all 0.2s;}
        .btn:hover{transform:translateY(-2px);}
        .btn-secondary{ background:var(--card); color:var(--primary); border:1px solid var(--border);}
        .btn-secondary:hover{ background:var(--primary); color:white;}
        .meal-select, .ing-list {width:100%;}
        .ing-list span {background:rgba(102,126,234,0.11); color:var(--primary); border-radius:7px; margin:0 4px; padding:2px 8px;}
        .tag {background:rgba(245,158,11,0.15); color:#f59e11; border-radius:4px; padding:2px 7px; margin-left:7px;font-size:0.92em;}
        .empty { color: var(--text-dim); font-size:1.02rem;}
        @media(max-width:660px){
            th, td { padding:0.4rem;}
        }
    </style>
</head>
<body>
<nav class="nav">
    <div class="nav-content">
        <div class="nav-brand">üè† Home Hub</div>
        <button class="nav-toggle" onclick="document.getElementById('navMenu').classList.toggle('active')">‚ò∞</button>
        <ul class="nav-menu" id="navMenu">
            <li><a href="../index.html">üìä Dashboard</a></li>
            <li><a href="meals.html">üçΩÔ∏è Meals</a></li>
            <li><a href="planner.html" class="active">üìÖ Planner</a></li>
            <li><a href="shopping.html">üõí Shopping</a></li>
            <li><a href="cleaning.html">üßπ Cleaning</a></li>
            <li><a href="maintenance.html">üõ†Ô∏è Maintenance</a></li>
            <li><a href="settings.html">‚öôÔ∏è Settings</a></li>
        </ul>
    </div>
</nav>
<div class="container">
    <div class="header">
        <h1>Weekly Meal Planner</h1>
        <div class="planner-action">
            <button class="btn" onclick="generateShoppingListFromPlanner()">Generate Shopping List</button>
            <a href="shopping.html"><button class="btn-secondary">Go To Shopping List</button></a>
        </div>
    </div>
    <table class="planner-table">
        <thead>
            <tr>
                <th>Day</th>
                <th>Meal</th>
                <th>Ingredients</th>
                <th>Type</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="plannerRows"></tbody>
    </table>
    <div class="empty" id="emptyPlanner" style="display:none;">No meals planned this week. Add meals using the Meals page or manually below.</div>
</div>
<script>
const WEEKDAYS = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
// Load meals from localStorage
const meals = JSON.parse(localStorage.getItem('hubMeals')||'[]');
function getMealOptions(){
    return meals.map(m=>`<option value="${m.id}">${m.title} (${m.type})</option>`).join('');
}
function loadPlanner(){
    let planner = JSON.parse(localStorage.getItem('hubPlanner')||'[]');
    // Ensure full week
    while(planner.length<7){ planner.push({meal:null});}
    return planner;
}
function savePlanner(planner){ localStorage.setItem('hubPlanner', JSON.stringify(planner)); }
function renderPlanner(){
    let planner = loadPlanner();
    let rows = '';
    let isEmpty = true;
    for(let i=0;i<7;i++){
        let mealObj = null;
        if(planner[i] && planner[i].meal){
            // Get meal by id
            mealObj = meals.find(m=>m.id === planner[i].meal.id) || planner[i].meal;
        }
        if(mealObj && mealObj.title) isEmpty = false;
        rows += `<tr>
            <td>${WEEKDAYS[i]}</td>
            <td>
                <select class="meal-select" onchange="setMeal(${i},this.value)">
                    <option value="">Select meal</option>
                    ${getMealOptions()}
                </select>
                ${mealObj && mealObj.title ? `<span class="tag">${mealObj.title}</span>`:""}
            </td>
            <td class="ing-list">${mealObj&&mealObj.ing?mealObj.ing.map(ing=>`<span>${ing}</span>`).join(' '):''}</td>
            <td>${mealObj && mealObj.type ? mealObj.type :"‚Äî"}</td>
            <td><button class="btn-secondary" onclick="clearDay(${i})">Clear</button></td>
        </tr>`;
    }
    document.getElementById('plannerRows').innerHTML = rows;
    document.getElementById('emptyPlanner').style.display = isEmpty ? "block":"none";
    // Set selected meal on each select
    let selects = document.querySelectorAll('.meal-select');
    let plannerData = loadPlanner();
    selects.forEach((s, idx) => {
        let id = plannerData[idx] && plannerData[idx].meal && plannerData[idx].meal.id ? plannerData[idx].meal.id : "";
        s.value = id;
    });
}
function setMeal(day, mealId){
    let planner = loadPlanner();
    let mealObj = meals.find(m=>m.id === mealId);
    planner[day].meal = mealObj ? {...mealObj} : null;
    savePlanner(planner);
    renderPlanner();
}
function clearDay(day){
    let planner = loadPlanner();
    planner[day].meal = null;
    savePlanner(planner);
    renderPlanner();
}
function generateShoppingListFromPlanner() {
    let planner = loadPlanner();
    // Get all weekly ingredients
    let weekIngredients = [];
    planner.forEach(slot => {
        if(slot.meal && slot.meal.ing){
            weekIngredients.push(...slot.meal.ing);
        }
    });
    // Merge quantities (same logic as in shopping.html)
    function parseIngredient(ingredient) {
        let parts = ingredient.trim().split(" ");
        if (parts.length>=2 && !isNaN(parts[0])) {
            return {name:parts.slice(1).join(" "), qty:Number(parts[0])};
        }
        return {name:ingredient.trim(), qty:1};
    }
    let merged = {};
    weekIngredients.forEach(i => {
        let {name, qty} = parseIngredient(i);
        let key = name.toLowerCase();
        if(name=='') return;
        if(merged[key]) merged[key].qty += qty;
        else merged[key]={name, qty};
    });
    // Now push this to hubShopping
    let shopping = JSON.parse(localStorage.getItem('hubShopping')||'[]');
    Object.values(merged).forEach(({name,qty}) => {
        let idx = shopping.findIndex(i=>i.name.toLowerCase()===name.toLowerCase());
        if(idx>=0) {
            shopping[idx].qty = (shopping[idx].qty||1)+qty;
        } else {
            shopping.push({name, qty, fav:false, checked:false});
        }
    });
    localStorage.setItem('hubShopping', JSON.stringify(shopping));
    alert("Weekly meals added to shopping list!");
}
renderPlanner();
</script>
</body>
</html>
