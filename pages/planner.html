<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Meal Planner - Home Hub</title>
    <style>
        :root {
            --primary: #667eea;
            --primary-dark: #764ba2;
            --gradient: linear-gradient(135deg,#f1d8ff 0%, #cfe8fc 100%);
            --bg: #f7f9fc;
            --card: #fff;
            --text: #273248;
            --text-dim: #7987a0;
            --border: #e3e6f2;
            --accent: #f59e42;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            min-height:100vh;
        }
        * { box-sizing: border-box; margin: 0; padding: 0;}
        .nav { background: var(--card); border-bottom: 1px solid var(--border); padding: 1rem 1.5rem; position: sticky; top: 0; z-index: 100;}
        .nav-content { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center;}
        .nav-brand { font-size: 1.5rem; font-weight: 800; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;}
        .nav-menu {display:flex;gap:0.5rem;list-style:none;}
        .nav-menu a {padding:0.6rem 1.2rem; border-radius:8px; text-decoration:none; color:var(--text-dim); font-weight:600;font-size:0.95rem; transition:all 0.2s;}
        .nav-menu a:hover { background: rgba(102,126,234,0.10); color:var(--primary);}
        .nav-menu a.active { background: var(--gradient); color: white; }
        @media(max-width:768px){
            .nav-menu{flex-direction:column;}
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 2rem 1.5rem;}
        .header {
            display: flex; flex-wrap:wrap; justify-content: space-between; align-items: center; margin-bottom: 2rem; gap:1rem;
        }
        h1 {
            font-size:2.2rem;
            background:var(--gradient);
            -webkit-background-clip:text;
            -webkit-text-fill-color:transparent;
            margin:0 0 0.6em 0;
            letter-spacing: 0.02em;
            font-weight: 800;
        }
        .planner-action { display:flex; gap: 0.9rem; margin-bottom:2rem; }
        .btn {
            padding:0.82rem 1.6rem;
            border-radius:8px;
            font-weight:600;
            cursor:pointer;
            border:none;
            background: var(--gradient);
            color:#764ba2;
            font-size:1rem;
            box-shadow:0 1px 6px #e3eaf8a0;
            transition:background 0.18s, color 0.16s;
        }
        .btn:hover{ background: linear-gradient(120deg,#bdb4fc 0%, #c3f2ff 100%); color:#3a216d;}
        .btn-secondary{
            background:#e3eafe;
            color:#764ba2;
            border:1.5px solid var(--border);
        }
        .btn-secondary:hover{background:var(--gradient);color:#3a216d;}
        /* Grid for planner days */
        .planner-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 2rem;
            margin-bottom:2rem;
        }
        @media(max-width:900px){
            .planner-grid { grid-template-columns:1fr; gap:1rem;}
        }
        .day-card {
            background:var(--card); 
            border:1.5px solid var(--border); 
            border-radius:17px;
            box-shadow: 0 2px 14px 0 #cfe8fc25;
            padding:1.4em 2em 1.2em 2em;
            min-width:260px; max-width:620px;
        }
        .day-label {
            font-size:1.25em;font-weight:800;background:var(--gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:0.9em;letter-spacing:0.02em;
        }
        .meal-block {
            margin-bottom:1.6em; font-size:1.08em;
        }
        .meal-header { font-weight:700; margin-bottom:0.28em; color:#273248;}
        .meal-cell-content { display:flex; align-items:center; gap:0.55em; margin-bottom:0.12em;}
        .meal-emoji { font-size:1.48em; margin-right:0.15em; }
        .meal-title { font-weight:700; background:var(--gradient); -webkit-background-clip:text; -webkit-text-fill-color:transparent; margin-right:0.33em; font-size:1.08em;}
        .meal-type {font-size:0.97em; color:#576389; font-style:italic; background:#e3eafe; border-radius:3px; padding:0 0.4em;}
        .meal-diet {font-size:0.97em; color:#b45309;background:#fff6ea;border-radius:3px; padding:0 0.4em; margin-left:0.3em;}
        .clear-link {color:var(--primary-dark);cursor:pointer;font-size:0.97em;background:none;border:none;}
        .clear-link:hover{text-decoration:underline;}
        .meal-ingredients {font-size:1.01em; color:#a05718; margin-left:2.3em; margin-top:-0.22em;}
        /* Dropdown styling for select (non-corporate look) */
        .meal-select {
            width:100%;
            padding:0.62em 1em;
            border-radius:8px;
            border:1.5px solid var(--border);
            background: #f6f8fc;
            color: #273248;
            font-size:1.06em;
            font-weight:500;
            transition: border 0.17s, box-shadow 0.17s;
            margin-bottom:0.26em;
            box-shadow:0 1px 4px #e3eaf868;
        }
        .meal-select:focus {
            border-color: var(--primary-dark);
            outline:none;
            background:#e3eafe;
            box-shadow:0 2px 8px #c3f2ff40;
        }
        .empty { color: var(--text-dim); font-size:1.02rem; margin-top:2em; text-align:center;}
        @media(max-width:660px){
            .meal-block {font-size:1em;}
            .day-label {font-size:1.1em;}
            .planner-grid {padding-left:0;padding-right:0;}
            .day-card{min-width:0;padding:1em 0.7em;}
        }
    </style>
</head>
<body>
<nav class="nav" aria-label="Main navigation">
    <div class="nav-content">
        <div class="nav-brand">üè† Home Hub</div>
        <ul class="nav-menu" id="navMenu">
            <li><a href="../index.html">üìä Dashboard</a></li>
            <li><a href="meals.html">üçΩÔ∏è Meals</a></li>
            <li><a href="planner.html" class="active">üìÖ Planner</a></li>
            <li><a href="shopping.html">üõí Shopping</a></li>
            <li><a href="cleaning.html">üßπ Cleaning</a></li>
            <li><a href="maintenance.html">üõ†Ô∏è Maintenance</a></li>
            <li><a href="settings.html">‚öôÔ∏è Settings</a></li>
        </ul>
    </div>
</nav>
<div class="container">
    <div class="header">
        <h1>Weekly Meal Planner</h1>
        <div class="planner-action">
            <button class="btn" onclick="generateShoppingListFromPlanner()">Generate Shopping List</button>
            <a href="shopping.html"><button class="btn-secondary">Go To Shopping List</button></a>
        </div>
    </div>
    <div class="planner-grid" id="plannerGrid"></div>
    <div class="empty" id="emptyPlanner" style="display:none;">No meals planned this week. Add meals using the Meals page or select meals below.</div>
</div>
<script>
const WEEKDAYS = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
const MEAL_TIMES = ["Breakfast", "Lunch", "Dinner", "Snack"];
const meals = JSON.parse(localStorage.getItem('hubMeals')||'[]');
// Return meal options with emoji and type, grouped
function getMealOptions(mt){
    return meals.map(m=>
        `<option value="${m.id}">${m.emoji ? m.emoji+" " : ""}${m.title} (${m.type||mt})</option>`
    ).join('');
}
function loadPlanner(){
    let planner = JSON.parse(localStorage.getItem('hubPlanner')||'[]');
    while(planner.length<7){ planner.push({slots:{}});}
    for(let i=0;i<7;i++){
        if(!planner[i].slots) planner[i].slots={};
    }
    return planner;
}
function savePlanner(planner){ localStorage.setItem('hubPlanner', JSON.stringify(planner)); }
// Accessibility: escape content
function escapeHTML(str) {
    if (!str) return '';
    return str.replace(/[&<>"']/g,
        function(m) { return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]; });
}

function renderPlanner(){
    let planner = loadPlanner();
    let isEmpty = true;
    let gridHTML = '';
    for(let i=0;i<7;i++){
        let slot = planner[i].slots;
        let blocks = '';
        MEAL_TIMES.forEach(mt=>{
            let mealObj = slot[mt] ? meals.find(m=>m.id === slot[mt].id) || slot[mt] : null;
            let mealCell = '';
            if(mealObj && mealObj.title){
                isEmpty = false;
                mealCell = `
                <div class="meal-cell-content">
                    <span class="meal-emoji">${escapeHTML(mealObj.emoji||"")}</span>
                    <span class="meal-title">${escapeHTML(mealObj.title)}</span>
                    <span class="meal-type">${mt.toLowerCase()}</span>
                    ${mealObj.diet && mealObj.diet.length ? `<span class="meal-diet">${escapeHTML(mealObj.diet.join(', '))}</span>` :''}
                    <button class="clear-link" onclick="clearMeal(event, ${i}, '${mt}')">Clear</button>
                </div>
                <div class="meal-ingredients">${ (mealObj.ing&&mealObj.ing.length)? escapeHTML(mealObj.ing.join(', ')) : ''}</div>
                `;
            } else {
                mealCell = `
                    <select class="meal-select" onchange="setMeal(${i},'${mt}',this.value)">
                        <option value="">Select ${mt}</option>${getMealOptions(mt)}
                    </select>
                `;
            }
            blocks += `<div class="meal-block">
                <span class="meal-header">${mt}:</span><br>${mealCell}
            </div>`;
        });
        gridHTML += `
        <div class="day-card">
            <div class="day-label">${WEEKDAYS[i]}</div>
            <div>${blocks}</div>
        </div>
        `;
    }
    document.getElementById('plannerGrid').innerHTML = gridHTML;
    document.getElementById('emptyPlanner').style.display = isEmpty ? "block":"none";
    // Repopulate selects
    let plannerData = loadPlanner();
    let selects = document.querySelectorAll('.meal-select');
    selects.forEach((s,idx) => {
        let day = Math.floor(idx/MEAL_TIMES.length);
        let time = MEAL_TIMES[idx%MEAL_TIMES.length];
        let id = plannerData[day] && plannerData[day].slots[time] && plannerData[day].slots[time].id ? plannerData[day].slots[time].id : "";
        s.value = id;
    });
}
function setMeal(day, mt, mealId){
    let planner = loadPlanner();
    let mealObj = meals.find(m=>m.id === mealId);
    if(!planner[day].slots) planner[day].slots={};
    planner[day].slots[mt] = mealObj ? {...mealObj} : null;
    savePlanner(planner);
    renderPlanner();
}
function clearMeal(event, day, mt){
    event.stopPropagation();
    let planner = loadPlanner();
    if(!planner[day].slots) planner[day].slots={};
    planner[day].slots[mt] = null;
    savePlanner(planner);
    renderPlanner();
}
function generateShoppingListFromPlanner() {
    let planner = loadPlanner();
    let weekIngredients = [];
    planner.forEach(slotObj=>{
        Object.values(slotObj.slots||{}).forEach(meal=>{
            if(meal && meal.ing){
                weekIngredients.push(...meal.ing);
            }
        });
    });
    function parseIngredient(ingredient) {
        let parts = ingredient.trim().split(" ");
        if (parts.length>=2 && !isNaN(parts[0])) {
            return {name:parts.slice(1).join(" "), qty:Number(parts[0])};
        }
        return {name:ingredient.trim(), qty:1};
    }
    let merged = {};
    weekIngredients.forEach(i => {
        let {name, qty} = parseIngredient(i);
        let key = name.toLowerCase();
        if(name=='') return;
        if(merged[key]) merged[key].qty += qty;
        else merged[key]={name, qty};
    });
    let shopping = JSON.parse(localStorage.getItem('hubShopping')||'[]');
    Object.values(merged).forEach(({name,qty}) => {
        let idx = shopping.findIndex(i=>i.name.toLowerCase()===name.toLowerCase());
        if(idx>=0) {
            shopping[idx].qty = (shopping[idx].qty||1)+qty;
        } else {
            shopping.push({name, qty, fav:false, checked:false});
        }
    });
    localStorage.setItem('hubShopping', JSON.stringify(shopping));
    alert("Weekly meals added to shopping list!");
}
// Render on load
window.addEventListener('DOMContentLoaded', renderPlanner);
</script>
</body>
</html>
