<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maintenance & Home Tasks Dashboard - Home Hub</title>
    <style>
        :root {
            --primary: #667eea;
            --primary-dark: #764ba2;
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --bg: #0f172a;
            --card: #1e293b;
            --text: #f1f5f9;
            --text-dim: #cbd5e1;
            --border: #334155;
            --seasonal: #f59e42;
            --overdue: #ef4444;
            --accent: #f59e42;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }
        .nav {
            background: var(--card);
            border-bottom: 1px solid var(--border);
            padding: 1rem 1.5rem;
            position: sticky; top: 0; z-index: 100;
        }
        .nav-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .nav-brand {
            font-size: 1.5rem;
            font-weight: 800;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .nav-toggle {
            display: none;
            background: none;
            border: none;
            color: var(--primary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
        }
        .nav-menu {
            display: flex;
            gap: 0.5rem;
            list-style: none;
        }
        .nav-menu a {
            padding: 0.6rem 1.2rem;
            border-radius: 8px;
            text-decoration: none;
            color: var(--text-dim);
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.2s;
        }
        .nav-menu a:hover { background: rgba(102, 126, 234, 0.1); color: var(--primary); }
        .nav-menu a.active { background: var(--gradient); color: white; }
        @media (max-width: 768px) {
            .nav-toggle { display: block; }
            .nav-menu {
                position: fixed; top: 70px; left: 0; right: 0;
                background: var(--card);
                flex-direction: column; padding: 1rem;
                transform: translateY(-100%);
                opacity: 0;
                pointer-events: none; transition: all 0.3s;
            }
            .nav-menu.active {
                transform: translateY(0); opacity: 1; pointer-events: all;
            }
            .nav-menu a { width: 100%; }
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 2rem 1.5rem; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem; }
        h1 { font-size: 2rem; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 0; }
        .today-date {font-size:1.04rem;color:var(--text-dim);margin-bottom:6px;}
        .dashboard {background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 1.1rem 1.2rem; margin-bottom: 2rem;}
        .dashboard-title {font-size: 1.18rem; font-weight: 700; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;margin-bottom:1rem;}
        .tasks-today, .tasks-overdue {margin-bottom: 0.8rem;}
        .filters {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.1rem 1.5rem;
            margin-bottom: 2rem;
        }
        .filter-group { margin-bottom: 1rem; }
        .filter-label { display: block; font-weight: 600; margin-bottom: 0.5rem; font-size: 0.92rem; text-transform: uppercase; letter-spacing: 0.05em; }
        .filter-btns { display: flex; flex-wrap: wrap; gap: 0.5rem; }
        .filter-btn {
            padding: 0.57rem 1.1rem;
            border: 2px solid var(--border);
            background: transparent;
            border-radius: 8px;
            color: var(--text-dim);
            font-weight: 600;
            font-size: 0.92rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .filter-btn:hover { border-color: var(--primary); color: var(--primary); }
        .filter-btn.active { background: var(--gradient); color: white; border-color: transparent; }
        select, input[type="search"], input[type="text"], input[type="number"], input[type="date"] {
            width: 100%;
            padding: 0.75rem 1rem;
            background: var(--bg);
            border: 2px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: 1rem;
        }
        input:focus, select:focus { outline: none; border-color: var(--primary); }
        .calendar-table {
            width: 100%;
            border-collapse: collapse;
            text-align: left;
        }
        .calendar-table th, .calendar-table td {
            padding: 0.5rem 0.6rem;
            border-bottom: 1px solid var(--border);
            font-size: 0.99rem;
        }
        .calendar-table th {
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 1rem;
        }
        .seasonal { color: var(--seasonal); }
        .overdue { color: var(--overdue); font-weight:700;}
        .area-tag {
            display: inline-block;
            padding: 0.22rem 0.84rem;
            border-radius: 6px;
            font-size: 0.87rem;
            font-weight: 600;
            margin: 0.18rem 0.3rem 0 0;
            background: rgba(102,126,234,0.1); color: #93c5fd; border: 1px solid rgba(102,126,234,0.22);
            text-transform: capitalize;
        }
        .seasonal-tag {
            background: rgba(245,158,66,0.16); color: #f59e42; border: 1px solid rgba(245,158,66,0.26);
        }
        .service-tag {
            background: rgba(34,197,94,0.13); color: #86efac; border: 1px solid rgba(34,197,94,0.20);
        }
        .appliance-tag {
            background: rgba(168,85,247,0.12); color: #d8b4fe; border: 1px solid rgba(168,85,247,0.20);
        }
        .btn {
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            margin-right: 0.3rem;
            margin-bottom:0.4rem;
            background: var(--gradient); color: #fff; transition: all 0.2s;
        }
        .btn:hover { transform: translateY(-2px);}
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center; padding: 1rem; }
        .modal.active { display: flex; }
        .modal-content { background: var(--card); border-radius: 18px; max-width: 650px; width: 100%; max-height: 90vh; overflow-y: auto; }
        .modal-header { padding: 1.4rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .modal-header h2 { margin: 0; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;}
        .modal-close { background: none; border: none; font-size: 2rem; color: var(--text-dim); cursor: pointer; }
        .modal-body { padding: 1.5rem; }
        .modal-footer { padding: 1rem 1.5rem; border-top: 1px solid var(--border); display: flex; gap: 0.5rem; justify-content: flex-end;}
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; font-weight: 600; margin-bottom: 0.32rem; }
        textarea, input[type=text], select, input[type=number] {
            width: 100%; padding: 0.65rem 1rem; background: var(--bg); border: 2px solid var(--border); border-radius: 8px; color: var(--text); font-size: 1rem;
        }
        textarea { min-height: 90px; resize: vertical; font-family: inherit;}
        .checks { display: flex; flex-wrap: wrap; gap: 0.8rem; }
        .check-label { display: flex; align-items: center; gap: 0.4rem; padding: 0.45rem 0.88rem; border: 1px solid var(--border); border-radius: 6px; cursor: pointer; }
        .empty { text-align: center; padding: 2rem 1rem; color: var(--text-dim);}
        .empty-icon { font-size: 3rem; margin-bottom: 1rem; opacity: 0.4;}
        @media (max-width: 480px) {
            .container { padding: 1.2rem 0.5rem; }
            .calendar-table th, .calendar-table td { font-size: 0.89rem;}
            .modal-footer { flex-direction: column;}
            .modal-footer .btn { width:100%;}
        }
    </style>
</head>
<body>
<nav class="nav">
    <div class="nav-content">
        <div class="nav-brand">üè† Home Hub</div>
        <button class="nav-toggle" onclick="document.getElementById('navMenu').classList.toggle('active')">‚ò∞</button>
        <ul class="nav-menu" id="navMenu">
            <li><a href="../index.html">üìä Dashboard</a></li>
            <li><a href="meals.html">üçΩÔ∏è Meals</a></li>
            <li><a href="planner.html">üìÖ Planner</a></li>
            <li><a href="shopping.html">üõí Shopping</a></li>
            <li><a href="cleaning.html">üßπ Cleaning</a></li>
            <li><a href="maintenance.html" class="active">üõ†Ô∏è Maintenance</a></li>
            <li><a href="settings.html">‚öôÔ∏è Settings</a></li>
        </ul>
    </div>
</nav>
<div class="container">
    <div class="header">
        <h1>Maintenance & Home Tasks Dashboard</h1>
        <span class="today-date" id="todayDate"></span>
        <button class="btn" onclick="openModal('add')">‚ûï Manual Add Task</button>
    </div>

    <div class="filters">
        <div class="filter-group">
            <div class="filter-label">Search by Room</div>
            <div class="filter-btns" id="roomFilters"></div>
        </div>
        <div class="filter-group">
            <div class="filter-label">Search by Frequency</div>
            <div class="filter-btns" id="freqFilters"></div>
        </div>
        <div class="filter-group">
            <div class="filter-label">Search</div>
            <input type="search" id="search" placeholder="Search tasks or areas..." oninput="applyFilters()">
        </div>
    </div>

    <div class="dashboard">
        <div class="dashboard-title">Tasks Due Today</div>
        <ul class="tasks-today" id="tasksToday"></ul>
        <div class="dashboard-title" style="margin-top:1rem;">Overdue Tasks</div>
        <ul class="tasks-overdue overdue" id="tasksOverdue"></ul>
    </div>

    <div class="calendar" style="margin-bottom:1.5rem;">
        <div style="margin-bottom:0.5rem;font-weight:600;">Maintenance Routine & Calendar</div>
        <table class="calendar-table" id="calendarTable">
            <thead>
                <tr>
                    <th>Task</th><th>Area</th><th>Type</th><th>Due Date</th><th>Day/Schedule</th><th>Frequency</th><th>Status</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <div class="empty" id="emptyTable" style="display:none;">
            <div class="empty-icon">üõ†Ô∏è</div>
            <h3>No maintenance tasks found for selected filters</h3>
            <p>Add a manual task or adjust your filters.</p>
        </div>
    </div>
</div>

<div class="modal" id="addModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Add Maintenance Task</h2>
            <button class="modal-close" onclick="closeModal('add')">&times;</button>
        </div>
        <form id="form" onsubmit="saveTask(event)">
            <div class="modal-body">
                <div class="form-group">
                    <label for="title">Task Name *</label>
                    <input id="title" type="text" required />
                </div>
                <div class="form-group">
                    <label for="area">Area/Room *</label>
                    <select id="area" required>
                        <option value="">Select area</option>
                        <option>Kitchen</option>
                        <option>Bathroom</option>
                        <option>Bedroom</option>
                        <option>Living</option>
                        <option>Garden</option>
                        <option>Conservatory</option>
                        <option>Garage</option>
                        <option>Loft</option>
                        <option>Office</option>
                        <option>Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="type">Task Type *</label>
                    <select id="type" required>
                        <option value="">Select type</option>
                        <option>General</option>
                        <option>Appliance</option>
                        <option>Service</option>
                        <option>Seasonal</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="frequency">Regularity *</label>
                    <select id="frequency" required>
                        <option value="">Select regularity</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                        <option value="seasonal">Seasonal</option>
                        <option value="yearly">Yearly</option>
                        <option value="once">One-off</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="routineDay">Routine/Day <span style="color:var(--text-dim);font-size:0.93em;">(choose day, date, or month)</span></label>
                    <input type="text" id="routineDay" placeholder="e.g. Monday, 15 Nov, March, Spring">
                </div>
                <div class="form-group">
                    <label for="due">Due Date *</label>
                    <input type="date" id="due" required />
                </div>
                <div class="form-group">
                    <label for="instructions">Checklist/Instructions</label>
                    <textarea id="instructions" placeholder="Checklist steps or reminders"></textarea>
                </div>
                <div class="form-group">
                    <label class="check-label">
                        <input type="checkbox" id="active" checked /> Add to Calendar & Routine
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" type="button" onclick="closeModal('add')">Cancel</button>
                <button class="btn" type="submit">Save</button>
            </div>
        </form>
    </div>
</div>

<script>
const ENGLISH_MONTHS = ["January","February","March","April","May","June","July","August","September","October","November","December"];
const ENGLISH_WEEKDAYS = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
function formatDate(dateStr){
    let d=new Date(dateStr);
    let wd = ENGLISH_WEEKDAYS[d.getDay()];
    let day = d.getDate();
    let m = ENGLISH_MONTHS[d.getMonth()];
    let y = d.getFullYear();
    return `${wd}, ${day} ${m} ${y}`;
}
document.getElementById("todayDate").textContent = formatDate("2025-11-11");

// Recommended maintenance tasks, tagged by room/type/frequency
const RECOMMENDED_TASKS = [
    // Bathroom
    {title:"Clean extractor fan", area:"Bathroom", type:"Appliance", frequency:"monthly", routine:"15th", due:"2025-11-15", active:true, instructions:["Remove cover","Clean dust","Reset"]},
    {title:"Descale shower head", area:"Bathroom", type:"General", frequency:"seasonal", routine:"Spring", due:"2026-03-21", active:true, instructions:["Remove shower head","Soak in descaler", "Rinse and replace"]},
    {title:"Check for leaks", area:"Bathroom", type:"General", frequency:"monthly", routine:"First Monday", due:"2025-11-03", active:true, instructions:["Inspect around sink, toilet and bath"]},
    // Kitchen
    {title:"Clean oven", area:"Kitchen", type:"Appliance", frequency:"monthly", routine:"End of month", due:"2025-11-30", active:true, instructions:["Remove racks","Apply oven cleaner","Wipe clean"]},
    {title:"Defrost freezer", area:"Kitchen", type:"Appliance", frequency:"yearly", routine:"December", due:"2025-12-10", active:true, instructions:["Turn off freezer","Remove ice","Clean shelves"]},
    {title:"Check appliance hoses", area:"Kitchen", type:"General", frequency:"monthly", routine:"Second Friday", due:"2025-11-14", active:true, instructions:["Inspect washing machine and dishwasher hoses"]},
    // Garden
    {title:"Mow lawn", area:"Garden", type:"General", frequency:"weekly", routine:"Saturday", due:"2025-11-15", active:true, instructions:["Check mower","Mow evenly"]},
    {title:"Tree pruning", area:"Garden", type:"Seasonal", frequency:"seasonal", routine:"Spring", due:"2026-03-15", active:true, instructions:["Prune before budding", "Remove dead wood"]},
    {title:"Clean patio", area:"Garden", type:"General", frequency:"monthly", routine:"Last weekend", due:"2025-11-29", active:true, instructions:["Sweep","Scrub stains"]},
    // Living
    {title:"Dust furniture", area:"Living", type:"General", frequency:"weekly", routine:"Friday", due:"2025-11-14", active:true, instructions:["Wipe surfaces","Vacuum behind furniture"]},
    {title:"Test smoke alarm", area:"Living", type:"Appliance", frequency:"monthly", routine:"First day", due:"2025-12-01", active:true, instructions:["Press test button","Change battery if needed"]},
    // Bedroom
    {title:"Flip mattress", area:"Bedroom", type:"General", frequency:"seasonal", routine:"March/Sept", due:"2026-03-01", active:true, instructions:["Vacuum first","Rotate and flip"]},
    {title:"Clean under bed", area:"Bedroom", type:"General", frequency:"monthly", routine:"15th", due:"2025-11-15", active:true, instructions:["Move storage boxes","Vacuum"]},
    // Garage
    {title:"Oil hinges on garage door", area:"Garage", type:"General", frequency:"monthly", routine:"First Saturday", due:"2025-11-08", active:true, instructions:["Check and oil hinges"]},
    {title:"Test garage remote", area:"Garage", type:"Appliance", frequency:"monthly", routine:"First Monday", due:"2025-12-01", active:true, instructions:["Replace batteries if needed"]},
    // Loft
    {title:"Boiler service", area:"Loft", type:"Service", frequency:"yearly", routine:"November", due:"2025-11-20", active:true, instructions:["Book engineer","Check pressure"]},
    {title:"Check insulation", area:"Loft", type:"General", frequency:"yearly", routine:"Autumn", due:"2025-10-21", active:true, instructions:["Inspect insulation coverage"]},
    // Office
    {title:"Clean monitor screen", area:"Office", type:"General", frequency:"monthly", routine:"15th", due:"2025-11-15", active:true, instructions:["Wipe with microfibre cloth"]},
    // Conservatory
    {title:"Window cleaning", area:"Conservatory", type:"General", frequency:"monthly", routine:"End of month", due:"2025-11-30", active:true, instructions:["Clean inside and outside"]},
];

let maintenance = [], current=null, filters={room:'all',freq:'all',search:''};

function init(){
    const d = localStorage.getItem('hubMaintenance');
    maintenance = d ? JSON.parse(d) : JSON.parse(JSON.stringify(RECOMMENDED_TASKS));
    if (!d) save();
    buildFilters();
    renderDashboard();
    renderCalendar();
}
function save(){
    localStorage.setItem('hubMaintenance', JSON.stringify(maintenance));
}
function buildFilters() {
    const rooms = ['all','Kitchen','Bathroom','Bedroom','Living','Garden','Conservatory','Garage','Loft','Office','Other'];
    const freqs = ['all','weekly','monthly','seasonal','yearly','once'];
    document.getElementById('roomFilters').innerHTML = rooms.map(room=>
        `<button class="filter-btn ${filters.room===room?'active':''}" onclick="setFilter('room','${room}',event)">${room}</button>`
    ).join('');
    document.getElementById('freqFilters').innerHTML = freqs.map(f=>
        `<button class="filter-btn ${filters.freq===f?'active':''}" onclick="setFilter('freq','${f}',event)">${f.charAt(0).toUpperCase()+f.slice(1)}</button>`
    ).join('');
}
function setFilter(k,v,e){
    filters[k]=v;
    document.querySelectorAll(`#${k==='room'?'room':'freq'}Filters .filter-btn`).forEach(b=>b.classList.remove('active'));
    e.target.classList.add('active');
    renderCalendar();
}
function applyFilters(){
    filters.search = document.getElementById('search').value;
    renderCalendar();
}
function renderDashboard(){
    let todayStr = "2025-11-11";
    let tasksToday = maintenance.filter(t=>{
        if(!t.active) return false;
        return t.due === todayStr;
    });
    let overdue = maintenance.filter(t=>{
        if(!t.active) return false;
        return (new Date(t.due) < new Date(todayStr)) && !t.history.includes(todayStr);
    });
    let elToday = document.getElementById("tasksToday");
    let elOverdue = document.getElementById("tasksOverdue");
    elToday.innerHTML = tasksToday.length ?
        tasksToday.map(t=>`<li><span>${t.title}</span> <span class="area-tag">${t.area}</span></li>`).join(''):
        '<li class="empty">No maintenance tasks due today.</li>';
    elOverdue.innerHTML = overdue.length ?
        overdue.map(t=>`<li><span>${t.title}</span> <span class="area-tag overdue">${t.area}</span></li>`).join(''):
        '<li class="empty">No overdue maintenance tasks.</li>';
}
function renderCalendar(){
    let tbody = document.querySelector("#calendarTable tbody");
    tbody.innerHTML = "";
    let filtered = maintenance.filter(t=>{
        if(filters.room!=='all' && t.area!==filters.room) return false;
        if(filters.freq!=='all' && t.frequency!==filters.freq) return false;
        if(filters.search && !t.title.toLowerCase().includes(filters.search.toLowerCase()) && !t.area.toLowerCase().includes(filters.search.toLowerCase())) return false;
        return true;
    }).sort((a,b)=>new Date(a.due)-new Date(b.due));
    document.getElementById("emptyTable").style.display = filtered.length? "none":"block";
    filtered.forEach((t,idx)=>{
        let status = t.history && t.history.includes(t.due) ? "‚úÖ Done" :
            (new Date(t.due).getTime() < new Date("2025-11-11").getTime() ? "<span class='overdue'>Overdue</span>" : "üîÑ Pending");
        tbody.innerHTML += `
            <tr>
                <td style="cursor:pointer;" onclick="viewTask(${idx})">${t.title}</td>
                <td><span class="area-tag${t.type==='Seasonal'?' seasonal-tag':''}${t.type==='Service'?' service-tag':''}${t.type==='Appliance'?' appliance-tag':''}">${t.area}</span></td>
                <td>${t.type}</td>
                <td>${formatDate(t.due)}</td>
                <td>${t.routine||''}</td>
                <td>${t.frequency.charAt(0).toUpperCase()+t.frequency.slice(1)}</td>
                <td>${status}</td>
            </tr>
        `;
    });
}
function viewTask(idx){
    let t = maintenance[idx];
    current = idx;
    let modal = document.createElement('div');
    modal.innerHTML = `
    <div class="modal-content">
        <div class="modal-header">
            <h2>${t.title}</h2>
            <button class="modal-close" onclick="document.body.removeChild(document.querySelector('.modal.active'))">&times;</button>
        </div>
        <div class="modal-body">
            <div>
                <strong>Area:</strong> <span class="area-tag">${t.area}</span> <br>
                <strong>Task Type:</strong> ${t.type} <br>
                <strong>Frequency:</strong> ${t.frequency.charAt(0).toUpperCase()+t.frequency.slice(1)}<br>
                ${t.routine?`<strong>Routine/Day:</strong> ${t.routine}<br>`:""}
                <strong>Due Date:</strong> ${formatDate(t.due)}<br>
                ${new Date(t.due)<new Date("2025-11-11") && (!t.history || !t.history.includes("2025-11-11")) ? "<span class='overdue'>Overdue!</span>" : ""}
            </div>
            <div style="margin-top:1em;">
                <strong>Instructions:</strong>
                <ul>${(t.instructions||[]).map(i=>`<li>${i}</li>`).join('')}</ul>
            </div>
            <div style="margin-top:1em;">
                <strong>History:</strong>
                ${t.history && t.history.length ?
                    `<ul>${t.history.map(h=>`<li>${formatDate(h)}</li>`).join('')}</ul>`
                    : "<div>No completion history yet.</div>"}
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="completeTaskModal();document.body.removeChild(document.querySelector('.modal.active'))">Mark Complete</button>
            <button class="btn" onclick="deleteTaskModal();document.body.removeChild(document.querySelector('.modal.active'))">Delete</button>
            <button class="btn" onclick="document.body.removeChild(document.querySelector('.modal.active'))">Close</button>
        </div>
    </div>
    `;
    modal.className = "modal active";
    document.body.appendChild(modal);
}
function completeTaskModal(){
    if(current!=null){
        let t = maintenance[current];
        if(!t.history) t.history=[];
        if(!t.history.includes(t.due)){
            t.history.push(t.due);
            let freqMap = { "weekly":7, "monthly":30, "seasonal":90, "yearly":365 };
            if(freqMap[t.frequency]){
                let nextDue=new Date(t.due);
                nextDue.setDate(nextDue.getDate()+freqMap[t.frequency]);
                t.due=nextDue.toISOString().split("T")[0];
            }
            save();
            renderDashboard();
            renderCalendar();
        }
    }
}
function deleteTaskModal(){
    if(current!=null){
        if(confirm("Delete this maintenance task?")){
            maintenance.splice(current,1);
            save();
            renderDashboard();
            renderCalendar();
        }
    }
}
function saveTask(e){
    e.preventDefault();
    let title = document.getElementById('title').value.trim();
    let area = document.getElementById('area').value;
    let type = document.getElementById('type').value;
    let frequency = document.getElementById('frequency').value;
    let routine = document.getElementById('routineDay').value.trim();
    let due = document.getElementById('due').value;
    let instructions = document.getElementById('instructions').value.split('\n').filter(l=>l.trim());
    let active = document.getElementById('active').checked;
    maintenance.unshift({
        title,area,type,frequency,routine,due,active,instructions,history:[]
    });
    save();
    document.getElementById('form').reset();
    closeModal('add');
    renderDashboard();
    renderCalendar();
    alert('Maintenance task added!');
}
function openModal(id){ document.getElementById(id+'Modal').classList.add('active'); }
function closeModal(id){ document.getElementById(id+'Modal').classList.remove('active'); }
window.addEventListener('DOMContentLoaded',init);
document.querySelectorAll('.modal').forEach(m=>m.addEventListener('click',e=>{if(e.target===m)m.classList.remove('active')}));
document.addEventListener('keydown',e=>{if(e.key==='Escape')document.querySelectorAll('.modal').forEach(m=>m.classList.remove('active'))});
</script>
</body>
</html>
